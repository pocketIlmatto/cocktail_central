YUI.add("flickr-photos-comments-getList-fetcher",function(e){"use strict";function t(e){var t={photo_id:e.id,offset:e.offset||0,limit:e.limit||4,sort:e.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:!0,use_text_for_links:1,secure_image_embeds:1};return e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=[],u=typeof n.comments.comment=="undefined"?0:n.comments.comment.length,a,f,l,c,h;return u>0&&e.Array.each(n.comments.comment,function(t,n,r){a={id:t.author,username:t.authorname,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro},a.pathAlias=t.pathAlias,l=s.exists(t.author)?s.proxy(t.author):s.add(a),f={id:t.id,author:l,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content,contentSecure:t.secureComment.content},o.push(i.exists(t.id)?i.proxy(t.id):i.add(f))}),r.exists(n.comments.photoId)?(c=r.proxy(n.comments.photoId).getValue("comments").getList(),h=c.concat(o),r.proxy(n.comments.photoId).setValue("comments",h)):r.add({id:n.comments.photoId,comments:o}),o}function r(t,n){var r=this;return e.Promise.all([n.callAPI("flickr.photos.comments.getList",this._processParams(t)),n.getModelRegistry("photo-comments-models"),n.getModelRegistry("comment-models"),n.getModelRegistry("person-models")]).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});
YUI.add("photo-comments-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{comments:{isListProxy:!0,rangeFetch:{listFetcher:e.ListFetchers["flickr-photos-comments-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-comments-getList-fetcher"]});
YUI.add("comments-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.appContext.flipper.isFlipped("comments-chronological")?(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:3,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:200):(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:4,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:10),this.isTooltipComments=e.isTooltipComments?!0:!1,this.currentlyShowingCount=0,this.initiallyShowingCount=0,this.textAreaMaxHeight=180,this.textAreaMinHeight=35,this.textAreaUserSetHeight=this.textAreaMinHeight,this.noIcons=e.noIcons,this.postingComment=!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelsRegistry=e})),n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(n){t.photoEngagement=n;var r=t.photoEngagement.getValue("commentCount"),i=e.config.win.location.hash,s=/#comment{1}/g;i&&s.test(i)?(t.initiallyShowingCount=r,t.currentlyShowingCount=r):r>=t.initiallyShowingMaximum?(t.initiallyShowingCount=t.initiallyShowingMaximum,t.currentlyShowingCount=t.initiallyShowingMaximum):(t.initiallyShowingCount=r,t.currentlyShowingCount=r)}).then(function(){return t.appContext.getModel("photo-comments-models",t.photoId)}).then(function(e){t.photoComments=e;if(t.photoEngagement.getValue("commentCount")>0)return t.photoComments.getValue("comments").getRange({offset:0,limit:t.initiallyShowingCount,photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){t.set("comments",e)});t.set("comments",[])})),n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.photoModel=e})),this.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.person=e})),e.Promise.all(n)},buildContainer:function(){var t,n=this.photoModel.getValue("url"),r=this.person?this.person.toJSON():null,i=this.get("comments"),s=this.appContext.flipper.isFlipped("comments-chronological")?"chronological":"reverse-chronological",o=this.calculateShowMoreCount(),u=o===1?"1 more comment":o+" more comments",a,f=e.config.win.location.hash,l=/#comment{1}/g;this.appContext.flipper.isFlipped("comments-chronological")&&(i=i.reverse()),this.isTooltipComments&&(this.ellipsis=this.intlMessage({intlName:"comments.SEE_MORE_LINK",photoUrl:n}));for(a=0;a<i.length;a++)i[a]=i[a].toJSON?i[a].toJSON():i[a],i[a].isSignedIn=this.appContext.getViewer().signedIn,i[a].isLoggedInUsersPhoto=this.isLoggedInUsersPhoto(),i[a].canCommentBeDeleted=this.canCommentBeDeleted(i[a].author.nsid),i[a].commentBelongsToViewer=this.commentBelongsToViewer(i[a].author.nsid),i[a].enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i[a].canComment=this.photoModel.getValue("canComment"),i[a].isTooltipComment=this.isTooltipComments,i[a].ellipsis=this.ellipsis,i[a].noIcons=this.noIcons;return t=this.templates("comments-view")({user:r,comments:i,showMore:this.calculateShowMoreCount()>0?!0:!1,showMoreCount:this.calculateShowMoreCount(),showMoreString:u,canComment:this.photoModel.getValue("canComment"),tutorialMode:!0,isTooltipComments:this.isTooltipComments,photoUrl:n,commentsOrder:s,commentsChronological:this.appContext.flipper.isFlipped("comments-chronological"),photosInCommentsClass:this.appContext.flipper.isFlipped("photos-in-comments")?"photosInComments":""}),this.setContainerHTML(t),this.retinafyCommentImages(),f&&l.test(f)&&this.jumpToPermalinkedComment(),this},buildErrorContainer:function(){this.setContainerHTML(this.templates("comments-view")({loadingError:!0}))},activate:function(){var t=this,n=t.get("container").one(".new-comment-text");return t.get("container").one(".comments-more")&&t.registerEventHandler(t.get("container").one(".comments-more a").on("click",t.handleMoreCommentsClick.bind(t))),e.use("transition",function(e){t.attachEvents({"keydown:comment":t.handleCommentKeyDown.bind(t),"blur:comment":t.handleCommentBlur.bind(t),"focus:comment":t.handleCommentFocus.bind(t),"mouseup:comment":t.handleCommentMouseUp.bind(t),"mouseleave:comment":t.handleCommentMouseLeave.bind(t),"mousedown:comment":t.handleCommentMouseDown.bind(t),".comment-reply click:reply":t.handleReplyClick.bind(t),".comment-delete click:delete":t.handleDeleteClick.bind(t),".comment-edit click:edit":t.handleEditClick.bind(t)})}),n&&n.setStyles({minHeight:this.textAreaMinHeight+"px",maxHeight:this.textAreaMaxHeight+"px"}),this},postComment:function(t){var n=this,r,i,s,o,u=this.photoEngagement.getValue("commentCount");n.fire("addingNewComment");if(e.Lang.trim(t)===""){this.onError("An empty comment box? That won't work!"),this.postingComment=!1;return}e.rapidTracker.beacon(this.name,"commentPosted"),this.commentModelsRegistry.remoteCreate({photoId:this.photoId,commentText:t,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")}).then(function(t){i=t.toJSON(),i.isSignedIn=n.appContext.getViewer().signedIn,i.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),i.enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i.canCommentBeDeleted=!0,i.commentBelongsToViewer=!0,i.canComment=!0,n.get("container").one(".new-comment-text").set("value","").setStyle("height",n.textAreaMinHeight+"px"),r=e.Node.create(n.templates("comment")(i)).setStyle("opacity","0.1"),u>0?n.appContext.flipper.isFlipped("comments-chronological")?n.get("container").one(".comments").append(r).one("li:last-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):n.get("container").one(".comments").prepend(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):(n.appContext.flipper.isFlipped("comments-chronological"
)?n.get("container").one(".comments-holder").prepend("<ul class='comments'></ul>"):n.get("container").one(".comments-holder").append("<ul class='comments'></ul>"),n.get("container").one(".comments").append(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"})),n.retinafyCommentImages(),s=n.photoComments.getValue("comments").prependToList(t),o=n.photoEngagement.getValue("commentCount")+1,n.photoEngagement.setValue("commentCount",o),n.currentlyShowingCount++,n.fire("newCommentAdded"),n.postingComment=!1},function(e){e.code===409?n.onError("Slow down, partner! To protect the Flickr community against spam and spammy behavior we place a few restrictions on commenting."):e.code===8?n.onError("An empty comment box? That won't work!"):n.onError("We couldn't post your comment."),n.postingComment=!1}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})},handleMoreCommentsClick:function(e){e.preventDefault();var t=this,n=this.get("container"),r="",i=n.one(".comments-more"),s;i.one("a").set("text","Loading"),i.addClass("is-loading"),this.appContext.getModel("photo-comments-models",this.photoId).then(function(e){e.getValue("comments").getRange({offset:t.currentlyShowingCount,limit:t.calculateShowMoreCount(),photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){var o;t.appContext.flipper.isFlipped("comments-chronological")&&(e=e.reverse());for(o=0;o<e.length;o++)s=e[o].toJSON(),s.isSignedIn=t.appContext.getViewer().signedIn,s.isLoggedInUsersPhoto=t.isLoggedInUsersPhoto(),s.canCommentBeDeleted=t.canCommentBeDeleted(s.author.nsid),s.commentBelongsToViewer=t.commentBelongsToViewer(s.author.nsid),s.enabledEditableComments=t.appContext.flipper.isFlipped("enable-editable-comments"),s.canComment=t.photoModel.getValue("canComment"),r+=t.templates("comment")(s);t.appContext.flipper.isFlipped("comments-chronological")?n.one(".comments").prepend(r):n.one(".comments").append(r),t.retinafyCommentImages(),t.currentlyShowingCount=t.currentlyShowingCount+e.length,t.calculateShowMoreCount()>0?(i.one("a").set("text",t.calculateShowMoreCount()+" more"),i.removeClass("is-loading")):i.remove()},function(e){t.onError("We couldn't get more comments.")}).then(null,function(e){t.appContext.error(e.message),t.appContext.error(e.stack)})})},calculateShowMoreCount:function(){var e=this.photoEngagement.getValue("commentCount");return e>this.currentlyShowingCount+this.showMoreMaximum?this.showMoreMaximum:e<=this.currentlyShowingCount+this.showMoreMaximum?e-this.currentlyShowingCount:0},isLoggedInUsersPhoto:function(){return this.photoModel.getValue("owner").getValue("nsid")===this.appContext.getViewer().nsid},canCommentBeDeleted:function(e){return e===this.appContext.getViewer().nsid||this.isLoggedInUsersPhoto()?!0:!1},commentBelongsToViewer:function(e){return e===this.appContext.getViewer().nsid?!0:!1},jumpToPermalinkedComment:function(){var t=e.config.win.location.hash,n=this.get("container"),r,i=this,s;r=n.one(t),r?(r.scrollIntoView(!0),r.addClass("permalinked-comment")):i.fire("viewEvent","getDialogOffset",function(t){s=e.Views.dialog.getNewInstance("dialog-alert",{content:"We were unable to find the specified comment in the Photo.",attrs:{title:"Oops!",level:"warning",confirmLabel:"OK"},parent:i,offsetLeft:t}),s.show()})},retinafyCommentImages:function(){if(this.appContext.getCookie("density")>1){var t=e.all(".comments li .comment-content a[data-photo-size-m]");t.each(function(e){e.one("img").setAttribute("src",e.getAttribute("data-photo-size-m")),e.removeAttribute("data-photo-size-m")})}},handleCommentKeyDown:function(e){var t=this,n=this.get("container").one(".new-comment-text"),r=n.get("value"),i=this.get("container").one(".false-comment-content"),s;if(e.charCode===13&&!e.altKey&&!e.shiftKey&&!this.postingComment){this.textAreaUserSetHeight=this.textAreaMinHeight,e.preventDefault(),this.postingComment=!0,this.postComment(r);return}setTimeout(function(){i.set("value",n.get("value")),s=i._node.scrollHeight<t.textAreaMinHeight?t.textAreaMinHeight:i._node.scrollHeight,s=i._node.scrollHeight>t.textAreaMaxHeight?t.textAreaMaxHeight:s,s=t.textAreaUserSetHeight>i._node.scrollHeight?t.textAreaUserSetHeight:s,n.setStyle("height",s+"px")},10)},handleCommentMouseDown:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=t.getComputedStyle("height"),isNaN(n)||(this.textAreaUserSetHeight=this.textAreaUserSetHeight!==n?n:this.textAreaUserSetHeight))},handleCommentMouseUp:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=parseInt(t.getComputedStyle("height"),10),!isNaN(n)&&this.textAreaUserSetHeight!==n&&(this.textAreaUserSetHeight=n>this.textAreaMaxHeight?this.textAreaMaxHeight:n,t.setStyle("height",this.textAreaUserSetHeight+"px")))},handleCommentMouseLeave:function(t){e.config.win.clearTimeout(this.textAreaUserMouseLeave),this.textAreaUserMouseLeave=setTimeout(e.bind(function(){var e=this.get("container").one(".new-comment-text"),t=0;e&&(t=parseInt(e.getComputedStyle("height"),10),isNaN(t)||(this.textAreaUserSetHeight=t<this.textAreaMinHeight?this.textAreaMinHeight:t,this.textAreaUserSetHeight=t>this.textAreaMaxHeight?this.textAreaMaxHeight:t))},this),100)},handleCommentBlur:function(e){var t=this.get("container").one("textarea");t.getData("notutorial")&&t.set("placeholder",t.getData("notutorial"))},handleCommentFocus:function(e){var t=this.get("container").one("textarea");t.getData("tutorial")&&t.set("placeholder",t.getData("tutorial"))},handleReplyClick:function(t){t.preventDefault();var n=this.get("container").one("textarea"),r=n.get("value"),i="",s=n.getDOMNode(),o;r.length>0&&(i+=r+" "),i+="["+e.url("/photos/"+t.target.getAttribute("data-pathalias"))+"] ",s.setSelectionRange?(s.focus(),s.setSelectionRange(s.value.length,s.value.length)):s.createTextRange&&(o=s.createTextRange(),o.collapse(!0),o.moveEnd("character",s.value.length),o.moveStart("character",s.value.length),o.select()),n.focus()
,n.set("value",i),s.scrollTop=s.scrollHeight},handleEditClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i=t.target.getAttribute("data-id"),s,o,u,a=this.get("container").one(".false-comment-content"),f;if(r.one("textarea")){r.one("textarea").remove(),r.one(".comment-content").show();return}n.appContext.getModel("comment-models",i).then(function(t){r.one(".comment-content").hide(),n.appContext.flipper.isFlipped("photos-in-comments")?r.append("<textarea>"+t.getValue("contentRaw")+"</textarea>"):r.append("<textarea>"+t.getValue("content")+"</textarea>"),s=r.one("textarea"),a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px"),s.select(),s.on("keydown",function(l){setTimeout(function(){a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px")},10);if(l.charCode===13&&!l.altKey&&!l.shiftKey&&!n.postingEditedComment){l.preventDefault();if(e.Lang.trim(s.get("value"))===""){n.onError("An empty comment box? That won't work!");return}n.postingEditedComment=!0,t.setValues({content:s.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(i).then(function(i){i?u=i.toJSON():u=t.toJSON(),u.isSignedIn=n.appContext.getViewer().signedIn,u.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),u.enabledEditableComments=n.appContext.flipper.isFlipped("enable-editable-comments"),u.canCommentBeDeleted=!0,u.commentBelongsToViewer=!0,u.canComment=n.photoModel.getValue("canComment"),u.isTooltipComment=n.isTooltipComments,u.ellipsis=n.ellipsis,o=e.Node.create(n.templates("comment")(u)),r.replace(o),n.fire("commentEdited"),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})}})})},handleDeleteClick:function(t){t.preventDefault();var n=this,r,i,s=t.target.ancestor(".comment"),o=t.target.getAttribute("data-id"),u;r=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Delete Comment",icon:"ui-icon-modal-warning",content:"Are you sure you want to delete this comment?",confirmButtonLabel:"Delete"}),r.render(),r.activate(),i=r.get("container"),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",function(){n.commentingDialog.close(),n.commentingDialog.destroy(),n.appContext.modelRegistries["comment-models"].remoteDelete(o).then(function(){n.photoComments.getValue("comments").removeFromList(o),u=n.photoEngagement.getValue("commentCount")-1,n.photoEngagement.setValue("commentCount",u),n.currentlyShowingCount--,n.fire("commentDeleted"),s.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){s.remove(),u===0&&n.get("container").one(".comments").remove()})},function(e){n.onError("We couldn't delete your comment.")}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})})),this.fire("subviewViewEvent","getDialogOffset",function(t){n.commentingDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:n.appContext,offsetLeft:t}),n.commentingDialog.show()})},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getNewInstance("dialog-alert",{content:t,attrs:{title:"Error",level:"warning",confirmLabel:"OK"},parent:n,offsetLeft:r});i.show()})}})},"@VERSION@",{requires:["dialog","flickr-view","moment","comments-css","hermes-template-comments","hermes-template-comment","hermes-template-comments-view","url"],langBundles:["comments"],optional:["photo-comments-models"]});
YUI.add("hermes-lang-comments",function(e,t){e.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>']})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-photo-charms",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+="\n		<button class='photo-charm-button' title='"+f((i=e.title,typeof i===a?i.apply(e):i))+"' data-charm-type='"+f((i=e.type,typeof i===a?i.apply(e):i))+"' data-track='"+f((i=e.type,typeof i===a?i.apply(e):i))+"CharmButtonClick'>\n			<i class='hide-text'>",s={hash:{},data:t},r+=f((i=n.capitalize||e.capitalize,i?i.call(e,e.title,s):l.call(e,"capitalize",e.title,s)))+"</i>\n		</button>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+="<div class='photo-charms-bar'>\n	",o=n.each.call(t,t.buttons,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;return s+="\n	\n	<div class='photo-charm-indicator hide-text'>\u2191</div>\n</div>\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-exif-view"],t.showExif,u):l.call(t,"outlet",t["photo-charm-exif-view"],t.showExif,u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-contexts-view"],t.showContexts,u):l.call(t,"outlet",t["photo-charm-contexts-view"],t.showContexts,u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-tags-view"],t.showTags,u):l.call(t,"outlet",t["photo-charm-tags-view"],t.showTags,u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-charms",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-charms-loading",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="',(o=n.className)?o=o.call(t,{hash:{},data:i}):(o=t.className,o=typeof o===a?o.apply(t):o),s+=f(o)+" photo-charm-panel-",(o=n.type)?o=o.call(t,{hash:{},data:i}):(o=t.type,o=typeof o===a?o.apply(t):o),s+=f(o)+' photo-charm-panel loading">\n	',u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t.loadingState,!1,u):l.call(t,"outlet",t.loadingState,!1,u)))+"\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-charms-loading",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-charms-view",function(e){var t="contexts",n="photoChm";e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.currentCharm=this.appContext.getCookie(n)||t,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.appContext.flipper.isFlipped("tags-charm")||delete this.subviewConfig["photo-charm-tags-view"],this},subviewConfig:{"photo-charm-contexts-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photo-charm-panel","photo-charm-panel-contexts"],disabled:function(){return this.currentCharm!=="contexts"}},"photo-charm-exif-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photo-charm-panel","photo-charm-panel-exif"],disabled:function(){return this.currentCharm!=="exif"}},"photo-charm-tags-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["photo-charm-panel","photo-charm-panel-tags"],disabled:function(){return this.currentCharm!=="tags"}}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var t=[{type:"exif",title:"Info"},{type:"contexts",title:"Also In"}],n,r,i,s,o,u=this;return this.appContext.flipper.isFlipped("tags-charm")&&t.push({type:"tags",title:"Tags"}),o=function(t,n){return u.templates("photo-charms-loading")({className:t,type:n,loadingState:u.templates(e.Balls())()})},r=this.subviews["photo-charm-contexts-view"]?this.subviews["photo-charm-contexts-view"].get("container"):o("photo-charm-contexts-view","contexts"),i=this.subviews["photo-charm-exif-view"]?this.subviews["photo-charm-exif-view"].get("container"):o("photo-charm-exif-view","exif"),s=this.subviews["photo-charm-tags-view"]?this.subviews["photo-charm-tags-view"].get("container"):o("photo-charm-tags-view","tags"),n=this.templates("photo-charms")({buttons:t,initialCharm:this.currentCharm,"photo-charm-contexts-view":r,"photo-charm-exif-view":i,"photo-charm-tags-view":s,showContexts:typeof this.subviews["photo-charm-contexts-view"]!="undefined",showTags:typeof this.subviews["photo-charm-tags-view"]!="undefined",showExif:typeof this.subviews["photo-charm-exif-view"]!="undefined"}),this.setContainerHTML(n),this},activate:function(){var t=this,n=t.get("container"),r,i,s=!0,o;return e.use("transition",function(e){t.charmsButtonClickHandler=t.registerEventHandler(n.on("click",t.handleCharmButtonClick,t))}),this.activateSubviews(),this.activateCharm(this.currentCharm),r=e.OverflowHelper.detectScrollbarSize(n),r>0&&(i=e.one("#content"),e.OverflowHelper.addFlowListener(i,"over",function(){(this.offsetWidth>this.clientWidth||this.offsetHeight>this.clientHeight)&&s&&(t.activateCharm(t.currentCharm),s=!1)},function(e){t.registerEventHandler(e)}),e.OverflowHelper.addFlowListener(i,"under",function(){this.offsetWidth===this.clientWidth&&!s&&(t.activateCharm(t.currentCharm),s=!0)},function(e){t.registerEventHandler(e)})),o=function(n){var r=n?"flickr:photo-page:focus_person_tag_entry":"flickr:photo-page:focus_tag_entry";return function(){t.get("container").one('[data-charm-type="tags"]')&&t.processCharmButtonClicked("tags",function(){setTimeout(function(){e.fire(r)},100)})}},this.attachKeyEvent("down:84",o),e.on("flickr:photo-page-open-add-tag",o(!1)),e.on("flickr:photo-page-open-add-people-tag",o(!0)),this},handleCharmButtonClick:function(e){var t=e.target,n,r;n=t.ancestor(".photo-charm-button",!0);if(!n)return;r=n.getAttribute("data-charm-type");if(!r)return;e.preventDefault(),this.processCharmButtonClicked(r)},processCharmButtonClicked:function(e,t){var n=this,r={exif:"photo-charm-exif-view",tags:"photo-charm-tags-view",contexts:"photo-charm-contexts-view"};this.currentCharm=e,this.subviews[r[this.currentCharm]]?typeof t=="function"&&t():(this.charmsButtonClickHandler.detach(),this.deferredSubviewInstantiation(r[this.currentCharm],this._params).then(function(){typeof t=="function"&&t()})),this.get("container").one(".photo-charm-indicator").addClass("active"),this.activateCharm(e),setTimeout(function(){var e=n.get("container").one(".photo-charm-indicator");e&&e.removeClass("active"),e=null},1e3)},activateCharm:function(e){var t=this.get("container"),r,i,s;i=t.one(".photo-charm-indicator"),r=t.one("[data-charm-type = "+e+"]"),t.all(".photo-charm-panel").setStyle("display","none"),t.one(".photo-charm-panel-"+e)&&t.one(".photo-charm-panel-"+e).setStyle("display","block"),r&&(s=r.get("offsetLeft")+r.get("offsetWidth")/2-i.get("offsetWidth")/2,i.setStyles({left:s+"px",opacity:1})),this.appContext.setCookie({remove:!0,cookieName:n,path:"/photos/",cookieValue:e})}})},"@VERSION@",{requires:["flickr-view","photo-charms-css","hermes-template-photo-charms","overflow-helper","hermes-template-photo-charms-loading","html5-balls"],optional:[]});
YUI.add("hermes-template-group-invitation-notification",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;return r+='\n	<p>\n		<a href="#">\n			<span class="ui-icon-notification">&nbsp;</span> \n			',(i=n.invitationCountString)?i=i.call(e,{hash:{},data:t}):(i=e.invitationCountString,i=typeof i===o?i.apply(e):i),r+=u(i)+"\n		</a>\n	</p>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t.isInvitations,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/group-invitation-notification",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-group-invitation-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{},attributes:{id:{},photoId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined}},groupId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined}},invitedBy:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});
YUI.add("flickr-photos-getGroupInvitations-fetcher",function(e){"use strict";function t(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=r.groups&&r.groups.group,f=n.id,l={},c=[],h=[];a&&e.Array.each(a,function(e,t){var r,i,a,f,l,p;r=[n.id,e.id].join("-"),i={id:r,photoId:n.id,groupId:e.id,invitedBy:e.invitedBy.nsid},a=s.exists(r)?s.proxy(r):s.add(i),f=u.parseGroupModel(n.id,n.pathAlias,e),l=u.exists(e.id)?u.proxy(e.id):u.add(f),p=o.exists(e.id)?o.proxy(e.id):o.add({id:e.id,pathAlias:e.pathAlias,group:l}),c.push(a),h.push(p)}),l={id:f,groups:h,invitations:c,total:c.length},i.exists(f)?i.setValues(f,l):i.add(l)}function n(t,n){var r=this;return e.Promise.all([n.callAPI("flickr.photos.getGroupInvitations",{photo_id:t.id,extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls",hermes:"1"}),n.getModelRegistry("photo-group-invitations-models"),n.getModelRegistry("photo-group-invitation-models"),n.getModelRegistry("group-pool-models"),n.getModelRegistry("group-models")]).then(function(e){r._processResponse(e,t)},function(e){throw n.error(e.message),n.error(e.stack),n[e.fatal?"error":"debug"]("[flickr-photos-getGroupInvitations-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-getGroupInvitations"]={run:n,_processResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-group-invitations-models","group-models","group-pool-models","person-models","photo-group-invitation-models"]});
YUI.add("flickr-groups-invite-photo-accept-updater",function(e){"use strict";function t(t,n){var r={},i=e.Models["group-pool-models"].extractGroupFromCompoundId(t.groupID);return r.user_id=t.userID,r.photo_id=t.photoID,r.group_id=i,e.Promise.all([n.callAPI("flickr.groups.invite.photo.accept",r),n.getModel("group-pool-models",i),n.getModelRegistry("photo-group-invitation-models"),n.getModelRegistry("photo-group-invitations-models"),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-groups-models"),n.getModelRegistry("photo-contexts-models")]).then(function(e){var n=e[0],r=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l;if(n.stat==="ok")return r.addPhotoLocal(u),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1),a.exists(t.photoID)&&!a.getValue(t.photoID,"groups").getFromListByID(r.getValue("id"))&&(a.getValue(t.photoID,"groups").prependToList(r),a.setValue(t.photoID,"total",a.getValue(t.photoID,"total")+1)),f.exists(t.photoID)&&!f.getValue(t.photoID,"contexts").getFromListByID(r.getValue("id"))&&(f.setValue(t.photoID,"totalGroups",f.getValue(t.photoID,"totalGroups")+1),f.getValue(t.photoID,"contexts").appendToList(r)),l=[t.photoID,i].join("-"),o.exists(t.photoID)&&o.getValue(t.photoID,"invitations").getFromListByID(l)&&(o.setValue(t.photoID,"total",o.getValue(t.photoID,"total")-1),o.getValue(t.photoID,"groups").removeFromList(i),o.getValue(t.photoID,"invitations").removeFromList(l)),s.remove(l),r}).then(null,function(e){throw n[e.fatal?"error":"debug"]("[flickr-groups-invite-photo-accept-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-groups-invite-photo-accept"]={run:t}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("flickr-groups-invite-photo-decline-updater",function(e){"use strict";function t(t,n){var r={},i=e.Models["group-pool-models"].extractGroupFromCompoundId(t.groupID);return r.user_id=t.userID,r.photo_id=t.photoID,r.group_id=i,e.Promise.all([n.callAPI("flickr.groups.invite.photo.decline",r),n.getModel("group-pool-models",i),n.getModelRegistry("photo-group-invitation-models"),n.getModelRegistry("photo-group-invitations-models")]).then(function(e){var n=e[0],r=e[1],s=e[2],o=e[3],u;if(n.stat==="ok")return u=[t.photoID,i].join("-"),o.exists(t.photoID)&&o.getValue(t.photoID,"invitations").getFromListByID(u)&&(o.setValue(t.photoID,"total",o.getValue(t.photoID,"total")-1),o.getValue(t.photoID,"groups").removeFromList(i),o.getValue(t.photoID,"invitations").removeFromList(u)),s.remove(u),r}).then(null,function(e){throw n[e.fatal?"error":"debug"]("[flickr-groups-invite-photo-decline-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-groups-invite-photo-decline"]={run:t}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("photo-group-invitations-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-getGroupInvitations"].run(t,this.appContext)},acceptInvitation:function(t,n){return e.ModelUpdaters["flickr-groups-invite-photo-accept"].run(t,n)},declineInvitation:function(t,n){return e.ModelUpdaters["flickr-groups-invite-photo-decline"].run(t,n)}},attributes:{id:{},groups:{isListProxy:!0},invitations:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getGroupInvitations-fetcher","flickr-groups-invite-photo-accept-updater","flickr-groups-invite-photo-decline-updater"]});
YUI.add("hermes-template-group-invitation-list-item",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i;return r+='\n		<img src="',(i=n.bestIconURL)?i=i.call(e,{hash:{},data:t}):(i=e.bestIconURL,i=typeof i===a?i.apply(e):i),r+=f(i)+'" class="album-selection-list-item-icon" />\n	',r}function p(e,t){return'\n		<img src="https://s.yimg.com/pw/images/buddyicon11_s.png" class="album-selection-list-item-icon" />\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<li class="album-selection-list-item ',(o=n["class"])?o=o.call(t,{hash:{},data:i}):(o=t["class"],o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-album-id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-machine-title="',(o=n.machineTitle)?o=o.call(t,{hash:{},data:i}):(o=t.machineTitle,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n	<span class="album-selection-list-item-icon-topper">&nbsp;</span>\n	<div class="album-selection-list-item-icon-wrapper">\n	',o=n["if"].call(t,t.bestIconURL,{hash:{},inverse:l.program(3,p,i),fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="album-selection-list-item-labels">\n		<span class="album-selection-list-item-title">\n			<a href="/groups/',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n				',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+'\n			</a>\n		</span>\n		<span class="group-invitation-actions">\n			<button class="ui-button group-invitation-decline"><span>',u={hash:{intlName:"common.DECLINE"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):c.call(t,"intlMessage",u)))+'</span></button>\n			<button class="ui-button group-invitation-accept"><span>',u={hash:{intlName:"common.ACCEPT"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):c.call(t,"intlMessage",u)))+"</span></button>\n		</span>\n	</div>\n</li>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/group-invitation-list-item",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-group-invitation-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+="\n		<ol class='album-selection-list loading'>\n			<li>",s={hash:{intlName:"photo-page-scrappy.LOADING_INVITATIONS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</li>\n		</ol>\n	",r}function d(e,t){var r="",i;r+="\n		<ol class='album-selection-list'>\n			",i=n["if"].call(e,e.albums,{hash:{},inverse:c.program(7,g,t),fn:c.program(4,v,t),data:t});if(i||i===0)r+=i;return r+="\n		</ol>\n	",r}function v(e,t){var r="",i;r+="\n				",i=n.each.call(e,e.albums,{hash:{},inverse:c.noop,fn:c.program(5,m,t),data:t});if(i||i===0)r+=i;return r+="\n			",r}function m(e,t){var i="",s;i+="\n					",s=c.invokePartial(r["group-invitation-list-item"],"group-invitation-list-item",e,n,r,t);if(s||s===0)i+=s;return i+="\n				",i}function g(e,t){var r="",i;return r+="\n				<div class='none'>",(i=n.none)?i=i.call(e,{hash:{},data:t}):(i=e.none,i=typeof i===h?i.apply(e):i),r+=l(i)+"</div>\n			",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+='<div class="album-selection">\n	<h2 class="album-selection-heading">',a={hash:{intlName:"photo-page-scrappy.PENDING_INVITATIONS_FOR_PHOTO"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</h2>\n	<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-close hide-text"><span>&nbsp;</span></button>\n	',u=n["if"].call(t,t.loading,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;return s+='\n	<div class="album-selection-buttons">\n		<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-done album-selection-done"><span>',a={hash:{intlName:"common.DONE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+"</span></button>\n	</div>\n</div>",s}),r={};e.Array.each(["group-invitation-list-item"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/group-invitation-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-group-invitation-list-item"]});
YUI.add("group-invitation-dialog-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("photoID",e.photoID),this.setContainerHTML(this.templates("group-invitation-dialog")({loading:!0})),this},loadState:function(){var e=this;return this.appContext.getModel("photo-group-invitations-models",this.get("photoID")).then(function(t){e.set("groupInvitationsModel",t),e.set("groupInvitationsModelRegistry",t.registry)}).then(null,function(t){throw e.onError({message:e.intlMessage({intlName:"photo-page-scrappy.ERROR_LOADING_GROUP_INVITATIONS"}),err:t,rejuvinate:!1}),t})},buildContainer:function(){var e=this.get("groupInvitationsModel").getValue("groups").toJSON(),t;return t=this.templates("group-invitation-dialog")({loading:!1,albums:e,none:this.intlMessage({intlName:"photo-page-scrappy.NO_GROUP_INVITATIONS"})}),this.setContainerHTML(t),this},activate:function(){var t=this.get("container");this.registerEventHandler(t.all(".ui-dialog-button-done, .ui-dialog-button-close").on("click",function(t){e.Views.dialog.close()})),this.registerEventHandler(t.all(".group-invitation-accept").on("click",this.handleAcceptInvitation,this)),this.registerEventHandler(t.all(".group-invitation-decline").on("click",this.handleDeclineInvitation,this))},handleAcceptInvitation:function(e){var t=this.get("groupInvitationsModelRegistry"),n=e.target.ancestor(".album-selection-list-item"),r=n.getAttribute("data-album-id"),i=this;return t.remote.acceptInvitation({userID:this.appContext.getViewer().nsid,photoID:this.get("photoID"),groupID:r},this.appContext).then(function(){i.get("groupInvitationsModel").getValue("groups").removeFromList(r),i.appContext.getModel("group-pool-models",r).then(function(e){i.appContext.getModel("photo-contexts-models",i.get("photoID")).then(function(t){t.getValue("contexts").appendToList(e)})}),i.fadeOutGroup(n)})},handleDeclineInvitation:function(e){var t=this.get("groupInvitationsModelRegistry"),n=e.target.ancestor(".album-selection-list-item"),r=n.getAttribute("data-album-id"),i=this;return t.remote.declineInvitation({userID:this.appContext.getViewer().nsid,photoID:this.get("photoID"),groupID:r},this.appContext).then(function(){i.get("groupInvitationsModel").getValue("groups").removeFromList(r),i.fadeOutGroup(n)})},fadeOutGroup:function(e){var t=this;e.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){e.remove(),t.get("groupInvitationsModel").getValue("groups").toJSON().length===0&&(t.buildContainer(),t.activate())})},onError:function(t){var n=this.get("container"),r,i=typeof t.rejuvinate=="undefined"?!0:t.rejuvinate,s,o,u=this,a,f=this.intlMessage({intlName:"common.ERROR"});t.err.code===6&&(f=""),o=new e.Views["confirmation-dialog-view"]({title:this.intlMessage({intlName:"common.ERROR"}),icon:"ui-icon-modal-error",heading:f,content:t.message,cancelButtonLabel:"",showCancelButton:!1,appContext:this.appContext}),o.render(),o.activate(),a=o.get("container"),this.fire("viewEvent","getDialogOffset",function(t){s=e.Views.dialog.getNewInstance("dialog-modal",{content:o.get("container"),appContext:u.appContext,offsetLeft:t}),s.show(),o.registerEventHandler(a.all(".ui-dialog-button-confirm, .ui-dialog-button-close").on("click",function(){s.hide(),i&&u.fire("viewEvent","getDialogOffset",function(t){r=e.Views.dialog.getNewInstance("dialog-modal",{content:n,appContext:u.appContext,offsetLeft:t}),r.show()})},u))}),this.appContext.error(t.err.message,t.err.stack)}})},"@VERSION@",{requires:["flickr-view","album-selection-css","group-invitation-dialog-css","hermes-template-group-invitation-dialog","hermes-template-group-invitation-list-item"],langBundles:["common","photo-page-scrappy"]});
YUI.add("group-invitation-notification-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.set("photoID",e.photoId),this.set("userID",e.nsid),this.setContainerHTML(""),this},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("person-relationship-models",this.get("userID")),this.appContext.getModel("photo-group-invitations-models",{id:this.get("photoID"),personId:this.get("userID")})]).then(function(e){t.set("ownerRelationshipModel",e[0]),t.set("groupInvitationsModel",e[1])})},buildContainer:function(){if(this.get("ownerRelationshipModel").getValue("isMe")){var e=this.get("groupInvitationsModel").getValue("groups").toJSON();this.setContainerHTML(this.templates("group-invitation-notification")({isInvitations:e.length>0,invitationCountString:e.length===1?"1 pending invitation":e.length+" pending invitations"}))}return this},activate:function(){var e=this.get("container").one("a"),t=this;e&&this.registerEventHandler(e.on("click",this.handleGroupInvitationClick,this)),this.registerEventHandler(this.get("groupInvitationsModel").on("valuesChanged",function(e){t.buildContainer(),t.activate()}))},handleGroupInvitationClick:function(t){t.preventDefault();var n,r,i=this;n=new e.Views["group-invitation-dialog-view"]({photoID:this.get("photoID"),appContext:this.appContext}),n.loadState().then(function(){n.buildContainer(),r=n.get("container"),r.addClass("album-selection-dialog-view"),r.addClass("group-selection-dialog-view"),i.fire("viewEvent","getDialogOffset",function(t){i.groupInvitationDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:i.appContext,offsetLeft:t}),i.groupInvitationDialog.show(),n._params.keyEventScope=i.groupInvitationDialog.getKeyEventScope(),n.activate()})},function(e){console.log("ERROR",e.message)}).then(null,function(e){console.log("ERROR",e.message)}),e.rapidTracker.beacon(this.name,"groupInvitationsClick")}})},"@VERSION@",{requires:["flickr-view","group-invitation-notification-css","hermes-template-group-invitation-notification","photo-group-invitations-models","group-invitation-dialog-view"]});
YUI.add("photo-sidebar-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.closeUrl=e.closeUrl,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["clear-float"]},"photo-stats-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-license-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"group-invitation-notification-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("pending-invitation-notification")}},"comments-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-charms-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"context-slider-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e;return e=this.templates("photo-sidebar")({"close-url":this.closeUrl,"attribution-view":this.subviews["attribution-view"].get("container"),"photo-title-desc-view":this.subviews["photo-title-desc-view"].get("container"),"photo-stats-view":this.subviews["photo-stats-view"].get("container"),"photo-license-view":this.subviews["photo-license-view"].get("container"),"actions-view":this.subviews["photo-sidebar-actions-view"].get("container"),"group-invitation-notification-view":this.appContext.flipper.isFlipped("pending-invitation-notification")?this.subviews["group-invitation-notification-view"].get("container"):"","comments-view":this.subviews["comments-view"].get("container"),"photo-charms-view":this.subviews["photo-charms-view"].get("container"),"context-slider-view":this.subviews["context-slider-view"].get("container")}),this.setContainerHTML(e),this},buildErrorContainer:function(){this.setContainerHTML(this.templates("photo-sidebar")({loadingError:!0}))},activate:function(){var e,t,n=this.get("container"),r,i;return n&&(r=n.one(".newCloseBtn"),i=n.one(".scrollingNewCloseBtn"),r&&i&&this.on("subviewViewEvent",function(n){if(n&&n.details&&n.details.length>1&&n.details[0]==="animateCloseBtn")return e=n.details[1].scrollTop,t=n.details[1].scrollbarSize,e>15?(r.addClass("scrolling"),r.removeClass("not-scrolling"),i.addClass("scrolling"),r.setStyle("right",t),i.setStyle("right",t+3)):e<=15&&(r.removeClass("scrolling"),r.addClass("not-scrolling"),i.removeClass("scrolling"),r.setStyle("right",t+10),i.setStyle("right",t+13)),!1})),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar","photo-sidebar-css","url-helper"],optional:["attribution-view","photo-title-desc-view","photo-stats-view","photo-license-view","photo-sidebar-actions-view","comments-view","photo-charms-view","group-invitation-notification-view","photo-models","person-models"],langBundles:["photo-sidebar"]});
YUI.add("hermes-lang-photo-sidebar",function(e,t){e.Intl.add("hermes/photo-sidebar","en-US",{ERROR_LOADING_SIDEBAR:["Error loading photo sidebar"],RETRY:["Retry"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-head-meta",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function d(e,t){var n="";return n+='description="'+l(typeof e===f?e.apply(e):e)+'"',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this,p=n.blockHelperMissing;s+='<meta name="',(o=n.metaName)?o=o.call(t,{hash:{},data:i}):(o=t.metaName,o=typeof o===f?o.apply(t):o),s+=l(o)+'" content="',a={hash:{},data:i},s+=l((o=n.renderMetaInfo||t.renderMetaInfo,o?o.call(t,t.metaValue,a):c.call(t,"renderMetaInfo",t.metaValue,a)))+'" ',a={hash:{},inverse:h.noop,fn:h.program(1,d,i),data:i},(u=n.metaDescription)?u=u.call(t,a):(u=t.metaDescription,u=typeof u===f?u.apply(t):u),n.metaDescription||(u=p.call(t,u,a));if(u||u===0)s+=u;return s+=' data-dynamic="true">\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-meta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
