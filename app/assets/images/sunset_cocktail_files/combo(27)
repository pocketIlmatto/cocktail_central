YUI.add("vendor-lighthouse",function(e,t){LH_start=+(new Date),function(e){"use strict";if(e.LH!==undefined&&e.LH.version!==undefined)return;var t="0.9",n=(window.location.protocol||document.location.protocol||"http:")+"//lh.secure.yahoo.com/lhbeam-"+t,r="root",i={beacon_url:n,timelines:{},tags:{},beaconNumber:0,navtimingBeaconSent:!1,beaconTimeout:10,onloadHandler:function(){setTimeout(i.onloadWorker,i.beaconTimeout)},onloadWorker:function(){var e=i.getPerformance();e.timing&&e.timing.loadEventEnd===0?setTimeout(i.onloadWorker,i.beaconTimeout):LH.beacon()},getBeaconUrl:function(){var t=this.beacon_url,n=e.document;return t?(t+=(t.indexOf("?")>-1?"&":"?")+"_uuid="+(this.uuid===null||this.uuid===undefined?"":encodeURIComponent(this.uuid)),t+="&_sid="+(this.spaceid===null||this.spaceid===undefined?"":encodeURIComponent(this.spaceid)),t+="&_sip="+(this.serverip===null||this.serverip===undefined?"":encodeURIComponent(this.serverip)),this.crumb&&(t+="&_crumb="+encodeURIComponent(this.crumb)),this.pvid&&(t+="&_pvid="+encodeURIComponent(this.pvid)),this.offset>0&&(t+="&offset="+this.offset),t+=(t.indexOf("?")>-1?"&":"?")+"u="+encodeURIComponent(n.URL.replace(/#.*/,"")),t):t},metrics:[],checkElemInMetrics:function(e){if(!i.metrics||i.metrics.length==0)return!0;for(var t in i.metrics)if(e===i.metrics[t])return!0;return!1},timelineFactory:function(e){return{state:0,name:e,startTime:parseInt(i.getPerformance().now()),dirty:!1,tags:{entries:{},toString:function(){var e="",t;for(t in this.entries){if(!this.entries.hasOwnProperty(t))continue;this.entries[t]===!0?e+="|t:"+t:e+="|t:"+t+","+this.entries[t]}return e}},type:{mark:{dirty:!1,entries:{},toString:function(){var e="",t,n;for(t in this.entries){if(!this.entries.hasOwnProperty(t)||!i.checkElemInMetrics(t))continue;e+="|m:"+t+",";for(n in this.entries[t])e+=this.entries[t][n].startTime+";"}return e}},measure:{dirty:!1,entries:{},toString:function(){var e="",t,n;for(t in this.entries){if(!this.entries.hasOwnProperty(t)||!i.checkElemInMetrics(t))continue;e+="|s:"+t+",";for(n in this.entries[t])e+=this.entries[t][n].startTime+","+this.entries[t][n].duration+";"}return e}},custom:{dirty:!1,entries:{},toString:function(){var e="",t,n;for(t in this.entries){if(!this.entries.hasOwnProperty(t)||!i.checkElemInMetrics(t))continue;e+="|r:"+t+",";for(n in this.entries[t])e+=this.entries[t][n].type+","+this.entries[t][n].startTime+","+this.entries[t][n].duration+";"}return e}}},toString:function(e){return e||(e=""),"c="+this.name+","+this.state+e+this.tags.toString()+e+this.type.mark.toString()+e+this.type.measure.toString()+e+this.type.custom.toString()}}},navTiming:function(){var e,t=i.getPerformance(),n,r,s,o;return t&&t.timing&&t.navigation&&(n=t.navigation,r=t.timing,o=r.navigationStart,s={navT:n.type,navS:o,fetS:r.fetchStart-o,dluS:r.domainLookupStart-o,dluE:r.domainLookupEnd-o,conS:r.connectStart-o,conE:r.connectEnd-o,reqS:r.requestStart-o,resS:r.responseStart-o,resE:r.responseEnd-o,domL:r.domLoading-o,domI:r.domInteractive-o,domS:r.domContentLoadedEventStart-o,domE:r.domContentLoadedEventEnd-o,domC:r.domComplete-o,lodS:r.loadEventStart-o,lodE:r.loadEventEnd-o},typeof r.linkNegotiationStart!="undefined"&&r.linkNegotiationStart!==0&&(s.lnkS=r.linkNegotiationStart-o),typeof r.linkNegotiationEnd!="undefined"&&r.linkNegotiationEnd!==0&&(s.lnkE=r.linkNegotiationEnd-o),r.unloadEventStart!==0&&(s.uldS=r.unloadEventStart-o,s.uldE=r.unloadEventEnd-o),r.redirectStart!==0&&(s.redC=n.redirectCount,s.redS=r.redirectStart-o,s.redE=r.redirectEnd-o),typeof r.secureConnectionStart=="number"&&(s.secS=r.secureConnectionStart>0?Math.max(1,r.secureConnectionStart-o):0),s.toString=function(t){var n="n=",r=0,s;if(i.hasOwnProperty("tags"))for(s in i.tags){if(!i.tags.hasOwnProperty(s))continue;n+=(r>0?"|":"")+"t:",i.tags[s]===!0?n+=s:n+=s+","+i.tags[s],r++}for(e in this){if(!this.hasOwnProperty(e)||e==="toString")continue;n+=(r>0?"|":"")+encodeURIComponent(e)+(this[e]===null||this[e]===undefined||parseInt(this[e])<=0?"":","+encodeURIComponent(this[e])),r++}return n}),s},offset:0,myNow:function(){return i.offset==0&&(i.offset=LH_start),+(new Date)-i.offset},getPerformance:function(){var t=e.performance||e.webkitPerformance||e.msPerformance||e.mozPerformance||e.Performance||{};return typeof t.now!="function"&&typeof t.webkitNow!="function"&&typeof t.msNow!="function"&&typeof t.mozNow!="function"&&(t.now=i.myNow),t.now=t.now||t.webkitNow||t.msNow||t.mozNow,t},getQueryParams:function(){var e={},t,n=/[?&]?([^=]+)=([^&]*)/g,r=window.location.search||document.location.search;r=r.split("+").join(" ");while(t=n.exec(r))e[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return e}};i.timelines.hasOwnProperty(r)||(i.timelines[r]=i.timelineFactory(r)),e.LH={t_start:LH_start,version:t,isInitialized:!1,init:function(t){var n,r,s=i.getQueryParams();t||(t={});for(n in t)t.hasOwnProperty(n)&&typeof t[n]!="function"&&(i[n]=t[n]);for(n in s)s.hasOwnProperty(n)&&typeof s[n]!="function"&&(i[n]=s[n]);return LH.isInitialized=!0,typeof t.log!="undefined"&&(this.log=t.log),this.log||(this.log=function(e,t,n){}),r=i.getPerformance(),r.timing&&r.timing.loadEventEnd==0?e.addEventListener?e.addEventListener("load",i.onloadHandler,!1):e.attachEvent&&e.attachEvent("onload",i.onloadHandler):i.onloadHandler(),this},metrics:function(e){typeof e=="string"?i.metrics=e.split(","):e instanceof Array&&(i.metrics=e)},newState:function(e){if(e!==undefined){if(!i.timelines.hasOwnProperty(e))throw new TypeError("Context not found");i.timelines.context.state++}e!=r&&i.timelines[r].state++},newContext:function(e){i.timelines.hasOwnProperty(e)||(i.timelines[e]=i.timelineFactory(e))},tag:function(e,t){var n,s=r,o;t&&(n=t.val),t&&typeof t.context=="string"&&(s=t.context),o=i.timelines[s],n!==undefined?o.tags.entries[e]=n:o.tags.entries[e]=!0},mark:function(e,t){var n=r,s,o,u,a;if(!e)throw new TypeError("Not enough arguments");return t&&typeof t.context=="string"&&(n=t.context),s=i.timelines[n],o=s.type.mark,u=o.entries,u[e]||
(u[e]=[]),a={duration:0,entryType:"mark",name:e,startTime:parseInt(i.getPerformance().now())},u[e].push(a),o.dirty=!0,s.dirty=!0,a},measure:function(e,t){var n,s,o=r,u,a,f,l=[],c={name:e,entryType:"measure"},h,p;t&&(n=typeof t.startMark=="string"?t.startMark:n,s=typeof t.endMark=="string"?t.endMark:s,a=typeof t.startMark=="object"?t.startMark:null,f=typeof t.endMark=="object"?t.endMark:null,o=typeof t.context=="string"?t.context:o),u=i.timelines[o],h=u.type.measure,p=h.entries;if(!e)throw new TypeError("Not enough arguments");if((s||f)&&!n&&!a)throw new SyntaxError("No startMark provided with endMark");if(n||a){n&&(l=u.type.mark.entries[n]);if(!a&&l instanceof Array&&l.length>0)a=l[l.length-1];else if(!a)throw new SyntaxError("startMark not found");c.startTime=a.startTime;if(s||f){s&&(l=u.type.mark.entries[s]);if(!f&&l instanceof Array&&l.length>0)f=l[l.length-1];else if(!f)throw new SyntaxError("endMark not found");c.duration=f.startTime-a.startTime}else c.duration=parseInt(i.getPerformance().now())-a.startTime}else c.startTime=0,c.duration=parseInt(i.getPerformance().now());return p[e]||(p[e]=[]),p[e].push(c),h.dirty=!0,u.dirty=!0,c},record:function(e,t,n){var s=r,o,u,a;return n&&typeof n.context=="string"&&(s=n.context),o=i.timelines[s],u=o.type.custom,a=u.entries,a[e]||(a[e]=[]),a[e].push(t),u.dirty=!0,o.dirty=!0,t},clearMarks:function(e){var t=r,n,s,o;e&&typeof e.context=="string"&&(t=e.context),n=i.timelines[t],s=n.type.mark,o=s.entries,e&&typeof e.name=="string"?o[name]&&(o[name].length=0,s.dirty=!0,n.dirty=!0):(s.entries={},s.dirty=!0,n.dirty=!0)},clearMeasures:function(e){var t=r,n,s,o;e&&typeof e.context=="string"&&(t=e.context),n=i.timelines[t],s=n.type.measure,o=s.entries,e&&typeof e.name=="string"?o[name]&&(o[name].length=0,s.dirty=!0,n.dirty=!0):(s.entries={},s.dirty=!0,n.dirty=!0)},clearCustomEntries:function(e){var t=r,n,s,o;e&&typeof e.context=="string"&&(t=e.context),n=i.timelines[t],s=n.type.custom,o=s.entries,e&&typeof e.name=="string"?o[name]&&(o[name].length=0,s.dirty=!0,n.dirty=!0):(s.entries={},s.dirty=!0,n.dirty=!0)},clearTags:function(e){var t=r,n;e&&typeof e.context=="string"&&(t=e.context),n=i.timelines[t],e&&typeof e.name=="string"?n.tags.entries[name]&&(delete n.tags.entries[name],n.dirty=!0):(n.tags.entries={},n.dirty=!0)},beacon:function(e){var t,n,s,o,u,a=r,f,l,c,h,p,d,v=i.LH_debug&&(i.LH_debug===!0||i.LH_debug==="true"||i.LH_debug==="1");i.hasOwnProperty("spaceid")&&(t=i.spaceid),i.hasOwnProperty("serverip")&&(n=i.serverip),i.hasOwnProperty("pvid")&&(s=i.pvid),i.hasOwnProperty("crumb")&&(o=i.crumb),e&&e.hasOwnProperty("spaceid")&&(i.spaceid=e.spaceid),e&&e.hasOwnProperty("serverip")&&(i.serverip=e.serverip),e&&e.hasOwnProperty("pvid")&&(i.pvid=e.pvid),e&&e.hasOwnProperty("crumb")&&(i.crumb=e.crumb),u=i.getBeaconUrl(),t&&(i.spaceid=t),n&&(i.serverip=n),s&&(i.pvid=s),o&&(i.crumb=o);if(v){d=i.getPerformance();if(d.getEntriesByType){f=d.getEntriesByType("resource"),console.log("Resources present: "+f.length);for(p in f)(f[p].name.indexOf("lh-")>=0||f[p].name.indexOf("lighthouse")>=0)&&console.log("Time for lighthouse resource",f[p])}}return u?(i.navtimingBeaconSent||(l=i.navTiming(),l&&l.lodE>0&&(u+=(u.indexOf("?")>-1?"&":"?")+i.navTiming().toString(),i.navtimingBeaconSent=!0)),e&&typeof e.context=="string"&&(a=e.context),c=i.timelines[a],u+=(u.indexOf("?")>-1?"&":"?")+c.toString(),v&&console.log("beacon url: "+u),i.beaconNumber++,h=new Image,v&&(h.onload=h.onerror=h.onabort=function(e){var t=e;return function(){var e=LH.mark("LH.endBeacon"),n=LH.measure("LH.beacon",{startMark:t,endMark:e});console.log("beacon response received",n)}}(LH.mark("LH.startBeacon"))),h.src=u,e&&e.clearMarks&&this.clearMarks(),e&&e.clearMeasures&&this.clearMeasures(),e&&e.clearCustomEntries&&this.clearCustomEntries(),e&&e.clearTags&&this.clearTags(),this):this}}}(window)},"@VERSION@",{affinity:"client"});
YUI.add("lighthouse",function(e){"use strict";var t=e.config.win,n,r=new e.Samplr;!t||!t.LH?e.Flog.warning("Missing Lighthouse vendor JS!"):n=t.LH,e.config.flickr.lighthouse_samples||e.Flog.warning("Missing Lighthouse sampling rates"),e.Lighthouse=function(t){this.hasData=!1;var n=0,i=t.pageId,s=t.signedIn,o=e.config.flickr.lighthouse_samples;n=o["default"],o[i]&&(n=typeof o[i]=="object"?o[i][s?"signedIn":"signedOut"]:o[i]);if(r.isInSample(n)){this.isActive=!0;try{this.initialize(t)}catch(u){e.Flog.warning("Lighthouse failed to initialize")}}else e.Flog.log("Lighthouse did not initialize because the request is not in the sample")},e.Lighthouse.prototype={initialize:function(r){var i,s,o,u,a;a={uuid:r.uuid,spaceid:r.spaceId,serverip:r.hostname,pvid:111111,crumb:"AXAXYBGH123",tags:{b:"reboot"}},e.config.flickr.pathogen?a.tags.b="pathogen":e.config.flickr.cdnUrls&&(a.tags.b="YCS_https"),r.signedIn&&(a.tags.l=!0),n.init(a),t.performance&&t.performance.timing&&(s=t.performance.timing),r.paft&&t.paftTiming&&t.paftTiming.final&&s&&(o=t.paftTiming.final-s.responseStart,n.record("AFT",{name:"AFT",type:"mark",startTime:o,duration:0}),n.beacon({spaceid:r.spaceId,clearMarks:!0,clearMeasures:!0,clearCustomEntries:!0,clearTags:!0})),t.pageTiming&&t.pageTiming.timeToFirstPhoto&&t.pageTiming.timeToFirstPhoto>0&&s&&(u=t.pageTiming.timeToFirstPhoto-s.responseStart,n.record("mark_time_to_first_photo",{name:"mark_time_to_first_photo",type:"mark",startTime:u,duration:0}),n.beacon({spaceid:r.spaceId,clearMarks:!0,clearMeasures:!0,clearCustomEntries:!0,clearTags:!0})),i=r.clientMetrics;if(!i)throw new Error("No client metrics found");i.on("metrics:page_start",this.handlePageStart.bind(this)),i.on("metrics:js_done",this.handleJSDone.bind(this)),i.on("metrics:mark",this.handleMark.bind(this)),i.on("metrics:record",this.handleRecord.bind(this)),i.on("metrics:beacon",this.handleBeacon.bind(this)),i.on("metrics:abort",this.abort.bind(this)),i.on("metrics:mark_start",this.handleMarkStart.bind(this)),i.on("metrics:mark_end",this.handleMarkEnd.bind(this))},abort:function(e){n.clearMarks(),n.clearMeasures(),n.clearCustomEntries(),n.clearTags(),this.hasData=!1},handlePageStart:function(e){n.mark("mark_unload"),this.hasData=!0},handleJSDone:function(e){try{n.mark("mark_fully_loaded"),n.measure("measure_js_done",{startMark:"mark_unload",endMark:"mark_fully_loaded"})}catch(e){this.abort()}},handleMark:function(e){if(e.markName)try{n.mark("mark_"+e.markName),n.measure("measure_"+e.markName,{startMark:"mark_unload",endMark:"mark_"+e.markName}),this.hasData=!0}catch(e){this.abort()}},handleRecord:function(e){if(e.markName&&e.timestamp)try{n.record("mark_"+e.markName,{name:"mark_"+e.markName,type:"mark",startTime:e.timestamp,duration:0}),this.hasData=!0}catch(e){this.abort()}},handleMarkStart:function(e){if(e.markName)try{if(!!this.markedStart)return;this.markedStart=e,n.mark("mark_"+e.markName+"_start")}catch(e){this.abort()}},handleMarkEnd:function(t){if(t.markName&&this.markedStart){if(this.markedStart.photoId!==t.photoId)return;try{n.mark("mark_"+t.markName+"_end"),n.measure("measure_"+t.markName,{startMark:"mark_"+t.markName+"_start",endMark:"mark_"+t.markName+"_end"})}catch(t){e.Flog.warn("Lighthouse: not able to measure: ",t),this.abort()}this.markedStart=null}},handleBeacon:function(t){if(this.hasData){var r={clearMeasures:!0,clearCustomEntries:!0,clearMarks:!0};e.config.flickr.pathogen?n.tag("b","pathogen"):e.config.flickr.cdnUrls?n.tag("b","YCS_https"):n.tag("b","reboot"),t.data&&(t.data.spaceid&&(r.spaceid=t.data.spaceid),t.data.is_logged_in&&n.tag("l",1)),n.clearMarks(),n.beacon(r),this.hasData=!1}}}},"@VERSION@",{requires:["vendor-lighthouse","samplr"],affinity:"client"});
