YUI.add("hermes-template-sub-photo-tags-tag-section",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n    <a href="#" class="show-add-tags">',s={hash:{intlName:"photo-page-scrappy.ADD_TAGS"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</a>\n",r}function d(e,t){var r="",i,s;return r+='\n    <input type="text" class= "add-tag" placeholder="',s={hash:{intlName:"photo-page-scrappy.ADD_A_TAG"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'">\n',r}function v(e,t,r){var i="",s,o,u;i+='\n    <li data-author="',(s=n.tagAuthorNSID)?s=s.call(e,{hash:{},data:t}):(s=e.tagAuthorNSID,s=typeof s===c?s.apply(e):s),i+=l(s)+'" data-tag-id="',(s=n.id)?s=s.call(e,{hash:{},data:t}):(s=e.id,s=typeof s===c?s.apply(e):s),i+=l(s)+'" class="tag ',u={hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t},o=(s=n.canRemoveTag||e.canRemoveTag,s?s.call(e,e.tagAuthorNSID,r.viewerNSID,r.isOwner,u):f.call(e,"canRemoveTag",e.tagAuthorNSID,r.viewerNSID,r.isOwner,u));if(o||o===0)i+=o;return i+='">\n	    <a class="remove-tag" href="#">\n	    	<i class="delete-tag" title="',u={hash:{intlName:"common.DELETE"},data:t},i+=l((s=n.intlMessage||e.intlMessage,s?s.call(e,u):f.call(e,"intlMessage",u)))+'"></i>\n	    </a>\n	    <a href="',(o=n.searchUrl)?o=o.call(e,{hash:{},data:t}):(o=e.searchUrl,o=typeof o===c?o.apply(e):o),i+=l(o)+'" title="',(o=n.tagRaw)?o=o.call(e,{hash:{},data:t}):(o=e.tagRaw,o=typeof o===c?o.apply(e):o),i+=l(o)+'">',(o=n.tagRaw)?o=o.call(e,{hash:{},data:t}):(o=e.tagRaw,o=typeof o===c?o.apply(e):o),i+=l(o)+"</a>\n    </li>\n",i}function m(e,t){return"can-remove-tag"}function g(e,t,r){var i="",s,o,u;i+='\n	    <li data-author="',(s=n.tagAuthorNSID)?s=s.call(e,{hash:{},data:t}):(s=e.tagAuthorNSID,s=typeof s===c?s.apply(e):s),i+=l(s)+'" data-tag-id="',(s=n.id)?s=s.call(e,{hash:{},data:t}):(s=e.id,s=typeof s===c?s.apply(e):s),i+=l(s)+'" class="tag ',u={hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t},o=(s=n.canRemoveTag||e.canRemoveTag,s?s.call(e,e.tagAuthorNSID,r.viewerNSID,r.isOwner,u):f.call(e,"canRemoveTag",e.tagAuthorNSID,r.viewerNSID,r.isOwner,u));if(o||o===0)i+=o;return i+='">\n		    <a class="remove-tag" href="#">\n		    	<i class="delete-tag" title="',u={hash:{intlName:"common.DELETE"},data:t},i+=l((s=n.intlMessage||e.intlMessage,s?s.call(e,u):f.call(e,"intlMessage",u)))+'"></i>\n		    </a>\n		    <a href="',(o=n.searchUrl)?o=o.call(e,{hash:{},data:t}):(o=e.searchUrl,o=typeof o===c?o.apply(e):o),i+=l(o)+'" title="',(o=n.tagRaw)?o=o.call(e,{hash:{},data:t}):(o=e.tagRaw,o=typeof o===c?o.apply(e):o),i+=l(o)+'">',(o=n.tagRaw)?o=o.call(e,{hash:{},data:t}):(o=e.tagRaw,o=typeof o===c?o.apply(e):o),i+=l(o)+"</a>\n	    </li>\n    ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;o=n["if"].call(t,t.canAddMeta,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(o||o===0)s+=o;s+="\n\n<h3>",a={hash:{intlName:"photo-page-scrappy.TAGS"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</h3>\n\n<ul class="tags-list">\n',u=n["if"].call(t,t.canAddMeta,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n",u=n.each.call(t,t.tags,{hash:{},inverse:h.noop,fn:h.programWithDepth(5,v,i,t),data:i});if(u||u===0)s+=u;s+='\n</ul>\n\n<div style="clear:both;"></div>\n\n<div class="machine-tags-section">\n    <ul class="machine-tags-list">\n    ',u=n.each.call(t,t.machineTags,{hash:{},inverse:h.noop,fn:h.programWithDepth(8,g,i,t),data:i});if(u||u===0)s+=u;return s+='\n    </ul>\n\n    <div style="clear:both;"></div>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-tags-tag-section",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-tags-tag",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return'data-tag-might-exist="true"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<li data-tag-id="',(o=n.escapedTagRaw)?o=o.call(t,{hash:{},data:i}):(o=t.escapedTagRaw,o=typeof o===f?o.apply(t):o),s+=l(o)+'" ',o=n["if"].call(t,t.mightExist,{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;return s+=' class="tag" data-validated="false">\n    <a class="remove-tag" href="#">\n        <i class="delete-tag" title="Delete"></i>\n    </a>\n    <a href="',a={hash:{},data:i},s+=l((o=n.getTagSearchUrl||t.getTagSearchUrl,o?o.call(t,t.tagValue,a):h.call(t,"getTagSearchUrl",t.tagValue,a)))+'" title="',(u=n.tagRaw)?u=u.call(t,{hash:{},data:i}):(u=t.tagRaw,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',(u=n.tagRaw)?u=u.call(t,{hash:{},data:i}):(u=t.tagRaw,u=typeof u===f?u.apply(t):u),s+=l(u)+"</a>\n</li>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-tags-tag",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("sub-photo-tags-tag-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId),photoTags:t.appContext.getModel("photo-tags-models",this.photoId),tagModel:t.appContext.getModelRegistry("tag-models")});return n.then(function(e){t.set("photo",e.photo),t.set("photoTags",e.photoTags),t.set("tagModel",e.tagModel)})},buildContainer:function(){var e,t=this.get("photo"),n=this.get("photoTags"),r=n.getValue("tags"),i=t.getValue("isOwner")||t.getValue("canAddMeta"),s=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,o=[],u=[],a,f=!0;r&&(r=r.toJSON(),r.length!==0&&(f=!1));for(a=0;a<r.length;a++)s.test(r[a].tagRaw)?o.push(r[a]):u.push(r[a]);f&&i&&this.get("container").addClass("empty");if(i||r.length>0)e=this.templates("sub-photo-tags-tag-section")({tags:u,emptyTags:f,machineTags:o,canAddMeta:t.getValue("isOwner")||t.getValue("canAddMeta"),viewerNSID:this.appContext.getViewer().nsid,isOwner:t.getValue("isOwner")});return this.setContainerHTML(e),this},activate:function(){var t=this.get("photo"),n=this.get("container"),r=t.getValue("owner")||t.getValue("canAddMeta"),i=this.get("photoTags"),s=i.getValue("tags"),o=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,u=[],a=this.appContext.flipper.isFlipped("machine-tags"),f=this,l,c=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;s&&(s=s.toJSON());for(l=0;l<s.length;l++)o.test(s[l].tagRaw)&&u.push(s[l]);return a&&u.length&&n.one(".machine-tags-section").setStyle("display","block"),r&&n.one(".show-add-tags")&&(n.one(".show-add-tags").on("click",function(t){t.preventDefault(),n.removeClass("empty"),n.one(".add-tag").setStyle("display","block"),n.one(".add-tag").focus(),e.one(".sub-photo-tags-view").removeClass("is-empty")}),this.setupAddTagEvents(),this.setupRollOverTagEvents(),this.setupRemoveTagEvents(),this.registerEventHandler(e.on("flickr:photo-page--new-tags-added",function(){f.buildContainer(),f.setupRollOverTagEvents(),f.setupRemoveTagEvents()})),this.registerEventHandler(e.on("flickr:photo-page:focus_tag_entry",function(e){var t=f.get("container");t&&t.one(".tags-list .add-tag")&&t.one(".tags-list .add-tag").focus()})),c&&this.attachKeyEvent("down:84",function(t){t.preventDefault();try{n.removeClass("empty"),n.one(".add-tag").setStyle("display","block"),n.one(".add-tag").focus(),e.one(".sub-photo-tags-view").removeClass("is-empty")}catch(r){}})),this},setupAddTagEvents:function(){var e=this.get("container"),t="",n=this;this.registerEventHandler(e.one(".add-tag").on("keydown",function(e){e.charCode===13&&(e.preventDefault(),this.blur())})),this.registerEventHandler(e.one(".add-tag").on("blur",function(){var r=this,i=r.get("value");if(i===t)return;r.set("value",""),i.length===0&&(i='""'),i.trim()!=='""'&&i.trim()!==t?(e.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".tags-list").all(".not-eol").removeClass("not-eol"),e.one(".machine-tags-section").getStyle("display")==="block"&&(e.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),e.one(".machine-tags-list").all(".not-eol").removeClass("not-eol")),n.saveTag(i),setTimeout(function(){r.focus()},4)):this.set("text",t)}))},_whichTagList:function(){var e=/^[a-zA-Z]\w*:[a-zA-Z]\w*=.+/,t=this.appContext.flipper.isFlipped("machine-tags"),n=this.get("container"),r=[n.one(".machine-tags-list"),n.one(".tags-list")];return function(i){return t&&e.test(i)?r[0]:r[1]}},saveTag:function(t){var n=this.get("container"),r=this.get("tagModel"),i=this.get("photoTags").getValue("tags"),s=!1,o=this._whichTagList(),u=this,a;a=this.processTag(t),s=i.getList().some(function(e){return a.indexOf(e.getValue("tagValue"))!==-1}),r.remoteCreate({photoId:[u.photoId],tags:[t]}).then(function(t){t.forEach(function(e){var t=e.getValue("tagRaw"),n=o(t),r=n.one("[data-tag-id='"+escape(t)+"']");r.setAttribute("data-tag-id",e.getValue("id")),r.setAttribute("data-validated","true"),r.setAttribute("data-tag-might-exist","false"),r.setAttribute("data-author",e.getValue("tagAuthorNSID")),r.addClass("can-remove-tag")}),e.all("[data-tag-might-exist='true']").set("text",u.intlMessage({intlName:"photo-page-scrappy.DUPLICATE_TAG"})).setAttribute("data-validated","true").addClass("invalid-tag"),e.all("[data-validated='false']").set("text",u.intlMessage({intlName:"photo-page-scrappy.INVALID_TAG"})).addClass("invalid-tag"),clearTimeout(u.invalidTagRemoval),u.invalidTagRemoval=setTimeout(function(){n.all(".invalid-tag").remove(!0)},4500)},function(t){var r,i;t.code===2&&(r=n.all(".tags-list, .machine-tags-list").all("[data-validated='false']"),r.size()&&r.remove(),i=u.intlMessage({intlName:"photo-page-scrappy.MAXIMUM_TAG_LIMIT"})),u.fire("subviewViewEvent","getDialogOffset",function(t){var n=e.Views.dialog.getNewInstance("dialog-alert",{content:i||u.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TAG"}),attrs:{title:u.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:u.intlMessage({intlName:"common.OK"})},parent:u,offsetLeft:t,dialogClass:"scrappy-dialog"});n.show()})}),a.forEach(function(e){var t=o(e).show(),r=t.hasClass("machine-tags-list"),i,a,f,l={tagValue:e.replace(/\s/g,""),tagRaw:e,escapedTagRaw:escape(e),mightExist:s};r?(e.indexOf(" ")>0?(a=e.indexOf("=")+1,f=e.substring(0,a)+'"'+e.substring(a)+'"',l.tagValue=f):l.tagValue=e,n.one(".machine-tags-section").getStyle("display")==="none"&&n.one(".machine-tags-section").setStyle("display","block"),i=u.templates("sub-photo-tags-tag")(l),t.prepend(i)):(l.tagValue=e.replace(/\s/g,""),i=u.templates("sub-photo-tags-tag")(l),t.one(".add-tag").insert(i,"after"))}),u.setupRollOverTagEvents()},setupRemoveTagEvents:function(){var t=this.get("container"),n=this.get("photoTags"),r=n.getValue("tags"),i=this.get("tagModel"),s=t.one(".machine-tags-list"
),o=this;this.registerEventHandler(t.all(".tags-list , .machine-tags-list").on("click",function(n){if(n.target.hasClass("remove-tag")||n.target.hasClass("delete-tag")){n.preventDefault();var u=n.target.ancestor(".tag"),a=u.getAttribute("data-tag-id");r.removeFromList(a,"id"),i.remoteDelete(a).then(null,function(){o.fire("subviewViewEvent","getDialogOffset",function(t){var n=e.Views.dialog.getNewInstance("dialog-alert",{content:o.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_TAG"}),attrs:{title:o.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:o.intlMessage({intlName:"common.OK"})},parent:o,offsetLeft:t});n.show()})}),u.remove(!0),s.getDOMNode().childElementCount||t.one(".machine-tags-section").setStyle("display","none"),t.one(".tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),t.one(".tags-list").all(".not-eol").removeClass("not-eol"),t.one(".machine-tags-section").getStyle("display")==="block"&&(t.one(".machine-tags-list").all(".end-of-the-line").removeClass("end-of-the-line"),t.one(".machine-tags-list").all(".not-eol").removeClass("not-eol")),r.toJSON().length===0&&(t.addClass("empty"),e.one(".sub-photo-tags-people-view").hasClass("empty")&&e.one(".sub-photo-tags-view").addClass("is-empty"))}}))},processTag:function(t){var n,r,i;i=t.replace(/"(.*?)"/g,function(e,t){return t=t.replace(/(,)/g,function(e,t){return t="{COMMA}",t}),t=t.replace(/(\s+)/g,function(e,t){return t="{WHITESPACE"+t.charCodeAt(0)+"}",t}),t}),i.indexOf(",")>-1?r=i.split(/,/):r=i.split(/\s+/);for(n in r)r[n]=r[n].replace(/\{WHITESPACE([0-9]+)\}/g,function(e,t){return t=String.fromCharCode(t),t}),r[n]=r[n].replace(/\{COMMA\}/g,function(e,t){return t=",",t});return e.Array.each(r,function(t,n){t=e.Lang.trim(t),r[n]=t}),r=e.Array.filter(r,function(e,t){if(e.length>0)return!0}),r},setupRollOverTagEvents:function(){var e=this.get("container"),t;this.registerEventHandler(e.all(".tag").on("mouseenter",function(e){t=e.currentTarget;if(t&&t.hasClass("can-remove-tag")){var n=t.ancestor(".tags-list")?t.ancestor(".tags-list").getDOMNode().offsetLeft:t.ancestor(".machine-tags-list").getDOMNode().offsetLeft,r=t.getDOMNode().offsetLeft,i=t.ancestor(".tags-list")?parseInt(t.ancestor(".tags-list").getComputedStyle("width").replace("px",""),10):parseInt(t.ancestor(".machine-tags-list").getComputedStyle("width").replace("px",""),10),s=parseInt(t.getComputedStyle("width").replace("px",""),10);i-(r-n+s)<=20?(t.removeClass("not-eol"),t.addClass("end-of-the-line")):(t.removeClass("end-of-the-line"),t.addClass("not-eol"))}}))}})},"@VERSION@",{requires:["flickr-view","dialog","hermes-template-sub-photo-tags-tag-section","hermes-template-sub-photo-tags-tag","sub-photo-tags-tag-section-css","url-helper"],optional:[],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-sub-photo-person",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var n="",r;return n+="data-"+f((r=(r=e.dataAttr,r==null||r===!1?r:r.key),typeof r===a?r.apply(e):r))+'="'+f((r=(r=e.dataAttr,r==null||r===!1?r:r.value),typeof r===a?r.apply(e):r))+'"',n}function h(e,t){var n;return f((n=(n=e.buddyicon,n==null||n===!1?n:n["default"]),typeof n===a?n.apply(e):n))}function p(e,t){var r;return(r=n.buddyicon)?r=r.call(e,{hash:{},data:t}):(r=e.buddyicon,r=typeof r===a?r.apply(e):r),f(r)}function d(e,t){return'\n		<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n		'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<li class="person" ',o=n["if"].call(t,t.dataAttr,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;s+='>\n	<div class="person-icon">\n		<a class="',(o=n.extraClasses)?o=o.call(t,{hash:{},data:i}):(o=t.extraClasses,o=typeof o===a?o.apply(t):o),s+=f(o)+'" href="/photos/',(o=n.pathAlias)?o=o.call(t,{hash:{},data:i}):(o=t.pathAlias,o=typeof o===a?o.apply(t):o),s+=f(o)+'/" data-track="',(o=n.dataTrackPrefix)?o=o.call(t,{hash:{},data:i}):(o=t.dataTrackPrefix,o=typeof o===a?o.apply(t):o),s+=f(o)+'PersonIconClick">\n			<div class="circle-icon" data-person-nsid="',(o=n.nsid)?o=o.call(t,{hash:{},data:i}):(o=t.nsid,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n				<img class="show-person-menu" src="',u=n["if"].call(t,(o=t.buddyicon,o==null||o===!1?o:o["default"]),{hash:{},inverse:l.program(5,p,i),fn:l.program(3,h,i),data:i});if(u||u===0)s+=u;s+='" width="32" height="32">\n			</div>\n				<span class="person-name">\n					',(u=n.displayname)?u=u.call(t,{hash:{},data:i}):(u=t.displayname,u=typeof u===a?u.apply(t):u),s+=f(u)+"\n				</span>\n		</a>\n		",u=n["if"].call(t,t.showRemove,{hash:{},inverse:l.noop,fn:l.program(7,d,i),data:i});if(u||u===0)s+=u;return s+="\n	</div>	\n</li>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-person",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-invite-person",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var n="",r;return n+="data-"+a((r=(r=e.dataAttr,r==null||r===!1?r:r.key),typeof r===u?r.apply(e):r))+'="'+a((r=(r=e.dataAttr,r==null||r===!1?r:r.value),typeof r===u?r.apply(e):r))+'"',n}function c(e,t){return'\n		<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n		'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<li class="person" ',o=n["if"].call(t,t.dataAttr,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='>\n	<div class="person-icon">\n		<div class="circle-icon">\n			<img src="https://s.yimg.com/pw/images/icon_unread.gif" width="',(o=n.size)?o=o.call(t,{hash:{},data:i}):(o=t.size,o=typeof o===u?o.apply(t):o),s+=a(o)+'" height="',(o=n.size)?o=o.call(t,{hash:{},data:i}):(o=t.size,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n		</div>\n		<p class="person-name">\n		',(o=n.email)?o=o.call(t,{hash:{},data:i}):(o=t.email,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n		</p>\n		",o=n["if"].call(t,t.showRemove,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+="\n	</div>\n</li>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/invite-person",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-creatr-footer",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<!-- creatr footer -->\n\n<div class="pure-g creatr-footer-wrapper">\n\n	<div class="pure-u-1-5">\n	</div>\n\n	<div class="pure-u-3-5">\n\n		<div class="legalese">\n\n			<a href="/ATOS/Create/" target="_blank">terms</a> | <a href="https://info.yahoo.com/privacy/us/yahoo/flickr/details.html" target="_blank">privacy</a> | <a href="https://help.yahoo.com/kb/index?page=content&y=PROD_FLICKR&locale=en_US&id=SLN22232" target="_blank">help</a>\n\n		</div>\n\n	</div>\n\n	<div class="pure-u-1-5">\n	</div>\n\n</div>\n'}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/creatr-footer",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-tags-people-section",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n    <a href="#" class="show-add-people">',s={hash:{intlName:"photo-page-scrappy.ADD_PEOPLE"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</a>\n",r}function p(e,t){var r="",i,s;return r+='\n<input type ="text" class="add-person" placeholder="',s={hash:{intlName:"photo-page-scrappy.ADD_PERSON"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'">\n',r}function d(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.person,{hash:{},inverse:c.program(8,m,t),fn:c.program(6,v,t),data:t});if(i||i===0)r+=i;return r+="\n\n",r}function v(e,t){var i="",s;i+="\n		",s=c.invokePartial(r["sub-photo-person"],"sub-photo-person",e.person,n,r,t);if(s||s===0)i+=s;return i+="\n	",i}function m(e,t){var i="",s;i+="\n		",s=c.invokePartial(r["invite-person"],"invite-person",e.invite,n,r,t);if(s||s===0)i+=s;return i+="\n	",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+="<h3>",a={hash:{intlName:"photo-page-scrappy.PEOPLE_IN_PHOTO"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+"</h3>\n\n",u=n["if"].call(t,t.canAddMeta,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;s+="\n\n",u=n["if"].call(t,t.canAddMeta,{hash:{},inverse:c.noop,fn:c.program(3,p,i),data:i});if(u||u===0)s+=u;s+='\n\n<div class="person-list">\n',u=n.each.call(t,t.people,{hash:{},inverse:c.noop,fn:c.program(5,d,i),data:i});if(u||u===0)s+=u;return s+='\n</div>\n\n<div style="clear:both;"></div>',s}),r={};e.Array.each(["sub-photo-person","invite-person"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-tags-people-section",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-person","hermes-template-invite-person"]});
YUI.add("hermes-template-photo-charm-tags-tag",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return'data-tag-might-exist="true"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=this,l="function",c=this.escapeExpression,h=n.helperMissing;s+="<li ",o=n["if"].call(t,t.mightExist,{hash:{},inverse:f.noop,fn:f.program(1,p,i),data:i});if(o||o===0)s+=o;return s+=' data-tag-id="',(o=n.escapedTagRaw)?o=o.call(t,{hash:{},data:i}):(o=t.escapedTagRaw,o=typeof o===l?o.apply(t):o),s+=c(o)+'" class="tag" data-validated="false">\n	<a class="remove-tag" href="#">x</a>\n	<a class="server-only-link" href="',a={hash:{},data:i},s+=c((o=n.getTagSearchUrl||t.getTagSearchUrl,o?o.call(t,t.tagValue,a):h.call(t,"getTagSearchUrl",t.tagValue,a)))+'" title="',(u=n.tagRaw)?u=u.call(t,{hash:{},data:i}):(u=t.tagRaw,u=typeof u===l?u.apply(t):u),s+=c(u)+'">',(u=n.tagRaw)?u=u.call(t,{hash:{},data:i}):(u=t.tagRaw,u=typeof u===l?u.apply(t):u),s+=c(u)+"</a>\n</li>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-charm-tags-tag",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("flickr-contacts-getListfetcher",function(e){"use strict";function t(t,n){var r=t[0],i=t[1];return r.contacts&&r.contacts.contact&&r.contacts.contact.forEach(function(t){i.exists(t.nsid)||i.add(e.APIHelper.response.parsePerson(t))}),r}function n(t,n){var r=this;return t.extras=(t.extras||"")+", icon_urls, paid_products",e.Promise.all([n.callAPI("flickr.contacts.getList",t),n.getModelRegistry("person-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-contacts-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-contacts-getList"]={run:n,_processResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-models"]});
YUI.add("contact-search-box",function(e){var t=function(e){this.options=e,this.options.elValue=this.options.elValue||"value",this.options.hideInitially||[],this._contacts=null,this.queryEl=this.options.el,this.queryElEvent,this.listEl=null,this.init()};t.prototype={langBundles:["common","photo-page-scrappy"],init:function(){var t=this;this.queryEl.on("keydown",this.keynav.bind(this)),this.queryElEvent=this.queryEl.on("keyup",this.search.bind(this)),this.wrapperEl=e.Node.create("<div/>"),this.wrapperEl.addClass("c-contact-search-autocomplete"),this.listEl=e.Node.create("<ul/>"),this.listEl.addClass("contact-list"),this.wrapperEl.appendChild(this.listEl),this.listEl.on("mouseover",function(e){var n=e.target.ancestor("li",!0);if(!n||n===t.highlighted)return;t._highlight(n)}),this.queryEl.ancestor().insertBefore(this.wrapperEl,this.queryEl),this.wrapperEl.appendChild(this.queryEl),this.options.clickContact=this.options.clickContact||function(e){var n=e.target.ancestor("[data-nsid]",!0).getData("nsid");t.select(n)},this.listEl.delegate("click",this.options.clickContact,"li"),this.selectedIndex=0},keynav:function(e){e.keyCode===38?(e.preventDefault(),this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.numShowing+this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):e.keyCode===40?(e.preventDefault(),this.selectedIndex++,this.selectedIndex>this.numShowing-1&&(this.selectedIndex=this.numShowing-this.selectedIndex),this._highlight(this.selectedIndex),this._scrollToNode(this.highlighted)):(e.keyCode===9||e.keyCode===13)&&this._visible&&this.highlighted&&(e.preventDefault(),this.select(this.highlighted.getData("nsid")))},_highlight:function(t){var n=this.listEl.all("li"),r=t instanceof e.Node,i=r?t:n.item(t),s=r?n.indexOf(t):t;i&&!i.hasClass("loading")&&!i.hasClass("no-members")&&(n.removeClass("highlight"),i.addClass("highlight"),this.selectedIndex=s,this.highlighted=i)},_scrollToNode:function(e){var t=this.listEl.get("scrollTop"),n=t+this.listEl.get("clientHeight"),r=e.get("offsetTop"),i=r+e.get("clientHeight"),s=5;t>r?this.listEl.set("scrollTop",r-s):n<i&&this.listEl.set("scrollTop",i-this.listEl.get("clientHeight")+s)},getContact:function(e){var t=0,n=this._contacts,r=n.length;for(;t<r;t++)if(n[t].nsid===e&&!n[t].hide)return n[t]},hideFromSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!0,!0})},showInSearch:function(e){e=e.trim(),this._contacts&&this._contacts.some(function(t){if(t.nsid.trim()===e)return t.hide=!1,!0})},load:function(e){var t={},n=this,r,i;if(this._busy)return;return this._end=!1,this._busy=!0,t.can_tag=this.options.canTag||0,i=this.options.appContext.getViewer().nsid,r=this.options.appContext.getModel("contacts-models",i),r.then(function(r){return t.page=1,t.perPage=3e3,t.per_page=3e3,n._loadMoreContacts(r,t,e)},function(){n._busy=!1,n.options.onError()})},_loadMoreContacts:function(e,t,n){var r=this;return this._busy=!0,this.options.loadingState&&!this.listEl.one("li.loading")&&this.appendLoader(),e.getValue("contacts").getPage(t).then(function(i){r.options.appContext.flipper.isFlipped("search-outside-contacts")||(r._busy=!1),r._contacts=(r.processContactModels(i,!0,!0)||[]).concat(r._contacts||[]),n(),t.page<e.getValue("pages")&&(t.page++,r._loadMoreContacts(e,t,n))},function(){r._busy=!1,r.options.onError()})},processContactModels:function(t,n,r){var i=this,s,o,u;try{u=t.map(function(e){return e.toJSON()})||[]}catch(a){u=[]}if(!i.contactIds){i.contactIds={};if(i._contacts)for(o in i._contacts)i.contactIds[o.id]=!0}return u=u.filter(function(e){return!i.contactIds[e.id]}),u.forEach(function(t,n){i.contactIds[t.id]=!0,t.realname=t.realname||t.username,t.isContact=r,t.buddyicon=e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver)}),n&&i.options.me&&(s=i.options.me.toJSON(),e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.buddyicon),s.buddyicon=s.buddyicon["default"],i.contactIds[s.id]=!0,s.me=!0,u.push(s)),i.options.hideInitially&&u.forEach(function(e){i.options.hideInitially.indexOf(e.nsid)>-1&&(e.hide=!0)}),u},destructor:function(){this.queryElEvent&&this.queryElEvent.detach&&this.queryElEvent.detach()},hide:function(e){e&&e.halt();if(!this._visible)return;this._visible=!1,this.highlighted=null,this.selectedIndex=0,this.selected=null,this.options.noShim||this._shimUp(!1),this.listEl.setStyle("display","none"),this.options.onHide&&this.options.onHide()},show:function(){if(this._visible)return;this._visible=!0,this.options.noShim||this._shimUp(),this.listEl.setStyle("display","block"),this._reposition(),this.options.onShow()},_reposition:function(){var t={width:e.config.win.innerWidth,height:e.config.win.innerHeight},n=this.options.el.getDOMNode().getBoundingClientRect(),r=this.listEl.getDOMNode().getBoundingClientRect(),i=!this._contacts,s=i&&this.options.upInitially,o;this.options.dialogOffset&&(o=this.options.dialogOffset()),s||n.top>0&&n.top+r.height+25>t.height&&!this.options.alwaysDownward?(this.listEl.setStyle("top","auto"),this.listEl.setStyle("bottom","25px"),this.options.onOrientationChange&&this.options.onOrientationChange(!0)):(this.listEl.setStyle("top",o||null),this.listEl.setStyle("bottom",null),this.options.onOrientationChange&&this.options.onOrientationChange(!1))},_shimUp:function(t){if(t===!1){if(!this._shim)return;this._shim.detach("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div/>"),this._shim.addClass(this.options.shim),this._shim.on("click",this.hide.bind(this)),this.wrapperEl.appendChild(this._shim)},select:function(e){typeof e=="string"&&(e=this.getContact(e),this.queryEl.set("value",e.realname)),this.selected=e,this.options.onSelect(e),this.hide()},search:function(e){var t=this.queryEl.get(this.options.elValue),n=this,r,i,s,o=this.options.appContext.getViewer().nsid;if(e&&e.keyCode===27){e.preventDefault(),this.queryEl.blur();return}if(e&&[38,40,9].indexOf(e.keyCode)!==-1){e.preventDefault();return}
this._nameTest(t),this.selected=null,this.selectedIndex=0,this.abort=!1;if(t.trim()==="")return this.abort=!0,this.hide();this.options.searchNonContacts||(this._end=!0,this._busy=!1);if(this._contacts&&this.options.me&&t==="me")return this.showResults(this._contacts.filter(function(e){return!e.hide&&e.me}).concat(this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})));if(this._isEmail(t))return this.select({email:t,nsid:null});if(/,/.test(t))return this.select(null);if(!this._contacts)return this.showResults(),this.options.signedOut?null:this.load(this.search.bind(this));r=this._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)}),this.showResults(r),i=n.listEl.getDOMNode(),this.options.searchNonContacts&&(this.options.loadMoreOnScroll&&n.options.appContext.flipper.isFlipped("search-outside-contacts")&&t.length>0?(s=1,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){n._searchPeople(t,o,s,n.searchInstanceId,function(){n._busy=!1,n.showResults(n._contacts.filter(function(e){return!e.hide&&n._matchesQuery(e)})),n.listElScrollEvent=n.listEl.on("scroll",function(){n.listEl._node.clientHeight+n.listEl._node.scrollTop===n.listEl._node.scrollHeight&&(s++,n._loadMore(s,o,t))})})},500)):(clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999))},_loadMore:function(e,t,n){var r=this;this._busy=!0,clearTimeout(this.searchAllPeople),this.searchInstanceId=Math.random()*999999,this.searchAllPeople=setTimeout(function(){r.options.loadingState&&!r.listEl.one("li.loading")&&this.appendLoader(),r._searchPeople(n,t,e,r.searchInstanceId,function(){r.showResults(r._contacts.filter(function(e){return!e.hide&&r._matchesQuery(e)})),r.listElScrollEvent&&r.listElScrollEvent.detach(),r.listElScrollEvent=r.listEl.on("scroll",function(){r.listEl._node.clientHeight+r.listEl._node.scrollTop===r.listEl._node.scrollHeight&&(e++,r._loadMore(e,t,n))})})},100)},_nameTest:function(t){var n=new RegExp(".*"+e.flutil.agnosticizeUnicode(t).replace(/\s/,"\\s")+".*","ig");this._matchesQuery=function(e){return n.test(e.username)||n.test(e.realname)||n.test(e.email)}},appendLoader:function(e){e=e||this.listEl;var t=document.createElement("li"),n=e.scrollTop;t.className="loading",t.innerHTML=this.options.loadingState,e.appendChild(t),e.scrollTop=n+t.clientHeight},_searchPeople:function(e,t,n,r,i){var s=this,o,u;s._end=!1,this.options.loadingState&&!this.listEl.one("li.loading")&&this.appendLoader(),o=s.options.appContext.getModel("contacts-models",t),o.then(function(t){return u=t.search({username:e,page:n}),u.then(function(e){var t=e.people,n=s.processContactModels(t,!1,!1);s._contacts=s._contacts||[],s._contacts=s._contacts.concat(n),s._contacts.some(function(e){return s._matchesQuery(e)})||(s._end=!0),i()},function(){s._end=!0,s._busy=!1,i()})},function(){s._end=!0,s._busy=!1,i()})},_isEmail:function(e,t){/,/.test(e)?e=e.split(/,/):e=[e];var n=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;if(t){while(e.length)if(n.test(e.shift().trim()))return!0;return!1}while(e.length)if(!n.test(e.shift().trim()))return!1;return!0},showResults:function(t){if(this.abort)return;var n=this.options.max||10,r,i,s=this;r=document.createDocumentFragment(),t&&this.selectedIndex>=t.length&&(this.selectedIndex=t.length-1),this.numShowing=Math.min(n,t&&t.length||0),!s._busy&&t&&t.length===0?(i=document.createElement("li"),i.innerHTML='<span class="no-contacts">'+this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"})+"</span>",i.className="no-members",r.appendChild(i),s.highlighted=null):t&&t.slice(0,n).forEach(function(t,n,i){var o=s.createItem(t);n===s.selectedIndex&&(o.setAttribute("class","highlight"),s.highlighted=e.Node(o)),r.appendChild(o)}),(this._busy||!t)&&this.options.loadingState&&this.appendLoader(r),this.options.loadMoreOnScroll&&this.listElScrollEvent&&this.listElScrollEvent.detach(),this.listEl.setHTML(""),this.listEl.getDOMNode().appendChild(r),this.show()},_template:function(){return['<img src="{{buddyicon}}">','<div class="following-status {{isContact}}">','<span class="following-icon">&nbsp;</span>',"<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>","</div>",'<h2 class="all">{{realname}}</h2>','<h3 class="all">{{username}}</h3>'].join("")},_onlyContactTemplate:['<img src="{{buddyicon}}">',"<h2>{{realname}}</h2>","<h3>{{username}}</h3>"].join(""),createItem:function(t){var n=document.createElement("li"),r,i=this.options.searchNonContacts?this._template():this._onlyContactTemplate,s=this.options.truncateLength||70;return r=i.replace(/\{\{(\w+)\}\}/g,function(n,r){if(r==="buddyicon")return t[r];if(r==="isContact")return t[r]?"am-following":"";var i=e.flutil.escapeInput(t[r]);return e.Handlebars.helpers.truncate(i,s)}),n.innerHTML=r,n.dataset?(n.dataset=n.dataset,n.dataset.nsid=t.nsid,n.dataset.displayname=t.realname||t.username,n.dataset.pathAlias=t.pathAlias):(n.setAttribute("data-nsid",t.nsid),n.setAttribute("data-displayname",t.realname||t.username),n.setAttribute("data-path-alias",t.pathAlias)),n}},e.mix(t.prototype,e.Localizable),e.ContactSearchBox=t},"@VERSION@",{requires:["api-helper","flutil","contact-search-css","handlebars-helpers","flickr-contacts-getListfetcher"],langBundles:["common","photo-page-scrappy"]});
YUI.add("sub-photo-tags-people-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this._css={locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-contact-search-shim"},this},loadState:function(){var t=this,n=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId),photoPeople:t.appContext.getModel("photo-people-models",this.photoId),peopleModel:t.appContext.getModelRegistry("person-in-photo-models"),person:t.appContext.getModelRegistry("person-models")});return n.then(function(e){t.set("photo",e.photo),t.set("photoPeople",e.photoPeople),t.set("peopleModel",e.peopleModel),t.set("person",e.person)}).then(function(){var e=t.appContext.getViewer();if(e.signedIn)return t.get("person").get(e.nsid).then(function(e){t.set("me",e)})})},buildContainer:function(){var e,t=this.get("photo"),n=this.get("photoPeople"),r=n.getValue("people"),i=t.getValue("isOwner")||t.getValue("canAddMeta"),s,o=t.getValue("isOwner"),u=this,a=!1;return r&&(s=r.toJSON(),s.length===0&&i&&(a=!0,this.get("container").addClass("empty")),s.forEach(function(e){e.person?(e.person.size=32,e.person.showRemove=u.canRemoveTag(o,this.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.dataAttr={key:"person-tag-nsid",value:e.person.nsid}):(e.invite={size:32,email:e.email},e.invite.showRemove=u.canRemoveTag(o,this.appContext.getViewer().nsid,e.addedBy,null),e.invite.dataAttr={key:"person-tag-email",value:e.invite.email})}),s=s.sort(function(e,t){return e.invite&&t.person?-1:e.person&&t.invite?1:e.person&&t.person&&e.person.displayname.toUpperCase()<t.person.displayname.toUpperCase()?-1:e.person&&t.person&&e.person.displayname.toUpperCase()>t.person.displayname.toUpperCase()?1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()<t.invite.email.toUpperCase()?-1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()>t.invite.email.toUpperCase()?1:0})),i||s.length>0?e=this.templates("sub-photo-tags-people-section")({people:s,canAddMeta:i,emptyPeopleTags:a}):e="",this.setContainerHTML(e),this},focusTag:function(){var e=this.get("container"),t=e.one(".add-person");t&&t.focus()},activate:function(){var t=this.get("container"),n=t.one(".add-person"),r="",i=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null,s=[],o=this,u=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return(e.one(".sub-photo-tags-tag-view").hasClass("empty")&&this.get("container").hasClass("empty")||!e.one(".sub-photo-tags-tag-view .tags-list")&&!this.get("container").one(".person-list"))&&e.one(".sub-photo-tags-view").addClass("is-empty"),t.one(".show-add-people")&&(this.registerEventHandler(t.one(".show-add-people").on("click",function(n){n.preventDefault(),t.removeClass("empty"),t.one(".c-contact-search-autocomplete").setStyle("display","block"),t.one(".add-person").setStyle("display","block"),t.one(".add-person").focus(),e.one(".sub-photo-tags-view").removeClass("is-empty")})),u&&this.attachKeyEvent("down:80",function(n){n.preventDefault();try{t.removeClass("empty"),t.one(".c-contact-search-autocomplete").setStyle("display","block"),t.one(".add-person").setStyle("display","block"),t.one(".add-person").focus(),e.one(".sub-photo-tags-view").removeClass("is-empty")}catch(r){}})),this.focus&&(setTimeout(function(){n.focus()},100),this.focus=!1),n&&(i&&(s=i.getList()),this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),this.contacts=new e.ContactSearchBox({el:n,appContext:this.appContext,shim:this._css.shim,elValue:"value",signedOut:!1,canTag:1,noShim:!0,searchNonContacts:!0,loadMoreOnScroll:!0,upInitially:!1,alwaysDownward:!0,loadingState:this.templates(e.Balls())(),max:1e3,hideInitially:s.map(function(e){return e.id}),me:this.get("me"),onError:function(){n.blur(),o.contacts.hide(),o.fire("subviewViewEvent","getDialogOffset",function(t){var n=e.Views.dialog.getInstance("dialog-alert",{content:o.intlMessage({intlName:"photo-page-scrappy.CONTACT_LIST_ERROR"}),attrs:{title:o.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:o.intlMessage({intlName:"common.OK"})},parent:o,offsetLeft:t,dialogClass:"scrappy-dialog"});n.show()})},onShow:function(r){var i=n.ancestor(".c-contact-search-autocomplete");o.arrow||(o.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>')),o.arrow.inDoc()||i.appendChild(o.arrow),o.arrow.removeClass("hide"),t.addClass(o._css.locked),o.fire("subviewViewEvent","make in view",t)},onSelect:function(e){e?t.removeClass(o._css.locked):t.addClass(o._css.locked)},onHide:function(){var e=n;o.arrow.addClass("hide"),e.setHTML(r),o.fire("subviewViewEvent","close in view")},onOrientationChange:function(e){o.arrow&&(e?o.arrow.addClass("upside-down"):o.arrow.removeClass("upside-down"))},clickContact:function(t){var i,s,u,a,f,l;if(e.UA.ie&&document.getSelection()){l=document.getSelection().anchorNode;if(l.id==="content")return}n.removeClass("focused"),n.setHTML(r),o.contacts.abort=!0,o.hideDropdown=setTimeout(function(){o.contacts.hide()},150),i=t.target.ancestor("[data-nsid]",!0);if(!i){o.contacts.hide();return}s=i.getData("nsid"),a=i.one("img").get("src"),u=i.getData("displayname")||"",f=i.getData("path-alias"),o.addTemporaryPersonTag(u,s,a,f),o.addRemotePersonTag(s),o.contacts.hideFromSearch(s),o.contacts.hide(),o.contacts.abort=!0,o.get("container").one(".add-person").set("value",""),o.get("container").one(".add-person").focus()}}),this.registerEventHandler(n.on("focus",function(){var t=this;this.addClass("focused"),o.contacts.abort=!1,setTimeout(function(){e.UA.ie&&(t.addClass("focused"),t.focus()),t.set("text","")},40)})),this.registerEventHandler(n.on("keydown",function(e){e.keyCode===13&&(e.halt(),clearTimeout(o.hideDropdown),n.focus
())})),this.registerEventHandler(n.on("blur",function(e){this.removeClass("focused")})),this.registerEventHandler(n.ancestor(".c-contact-search-autocomplete").on("focus",function(e){e.target.hasClass("c-contact-search-autocomplete")&&(clearTimeout(o.hideDropdown),n.focus())}))),t.one(".person-list")&&this.registerEventHandler(t.one(".person-list").on("click",function(e){e.target.hasClass("remove-person")?o.removeTag(e):e.target.ancestor("[data-loading]")&&e.preventDefault()})),this},removeTag:function(e){e.preventDefault();var t=e.target.ancestor("[data-person-tag-nsid]"),n=e.target.ancestor("[data-person-tag-email]"),r=this.get("photoPeople").getValue("people"),i,s;t?(i=t.getData("person-tag-nsid"),t.setAttribute("data-loading",i),r.removeFromList(i,"id"),this.remoteRemoveTag(i),this.contacts.showInSearch(i)):n?(s=n.getData("person-tag-email"),n.setAttribute("data-loading",s),r.removeFromList(s,"email"),this.remoteRemoveTag(null,s)):this.appContext.warn("[photo-charm-tags-people-view] tried to remove invalid person tag.")},remoteRemoveTag:function(t,n){var r=this.get("container"),i=r.one(".person-list"),s=t?"userId":"email",o=t||n,u=this,a={photoId:this.photoId,coords:{x:0,y:0,w:0,h:0}};a[s]=o,this.get("peopleModel").remoteDelete(a).then(function(){var s=t?i.one('[data-person-tag-nsid="'+t+'"]'):i.one('[data-person-tag-email="'+n+'"]');s&&s.remove(!0),i.one("li")||(r.one(".c-contact-search-autocomplete").setStyle("display","none"),r.addClass("empty"),e.one(".sub-photo-tags-tag-view").hasClass("empty")&&e.one(".sub-photo-tags-view").addClass("is-empty"))},function(t){u.fire("subviewViewEvent","getDialogOffset",function(t){var n=e.Views.dialog.getInstance("dialog-alert",{content:u.intlMessage({intlName:"photo-page-scrappy.FAILED_TO_REMOVE_PERSON"}),attrs:{title:u.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:u.intlMessage({intlName:"common.OK"})},appContext:u.appContext,offsetLeft:t,dialogClass:"scrappy-dialog"});n.show()})})},addTemporaryPersonTag:function(e,t,n,r){this.addPerson({dataAttr:{key:"loading",value:t},buddyicon:n,size:50,displayname:e,pathAlias:r||t,showRemove:!0})},addPerson:function(e){var t=this.get("container"),n=t.one(".person-list"),r=this.templates("sub-photo-person")(e);n.prepend(r)},addRemotePersonTag:function(e){var t=this.get("container"),n=t.one(".person-list"),r=this,i=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null;this.get("peopleModel").remoteCreate({photoId:this.photoId,userId:e,addedBy:r.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0}}).then(function(t){var s,o,u=n.one('[data-loading="'+e+'"]');u&&(u.removeAttribute("data-loading"),u.setAttribute("data-person-tag-nsid",e)),s=r.get("peopleModel"),o=s.add(t),i&&i.appendToList(o)},function(){var i=n.one('[data-loading="'+e+'"]');i.one(".person-name").set("text",r.intlMessage({intlName:"photo-page-scrappy.PERSON_CANNOT_BE_TAGGED"})),i.addClass("invalid-person-tag"),setTimeout(function(){t.all(".invalid-person-tag").remove(!0)},4500)})},canRemoveTag:function(e,t,n,r){return e||t&&n===t||r&&r===t}})},"@VERSION@",{requires:["flickr-view","dialog","hermes-template-sub-photo-person","hermes-template-invite-person","hermes-template-creatr-footer","hermes-template-sub-photo-tags-people-section","hermes-template-photo-charm-tags-tag","photo-charms-tags-people-section-css","url-helper","contact-search-box","html5balls"],optional:[],langBundles:["common","photo-page-scrappy"]});
