YUI.add("hermes-template-context-image",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;return r+='\n\n	<a data-loaded="false" style="left:',(i=n.left)?i=i.call(e,{hash:{},data:t}):(i=e.left,i=typeof i===o?i.apply(e):i),r+=u(i)+';float:left;display:block;position:absolute;background-color:gray;height:40px;width:86px;border:1px solid transparent;" href="#">\n		\n	</a>\n\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t.images,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-image",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-context-text",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='\n\n<span data-loaded="true" style="left:',(o=n.left)?o=o.call(t,{hash:{},data:i}):(o=t.left,o=typeof o===u?o.apply(t):o),s+=a(o)+';float:left;display:block;position:absolute;height:40px;width:86px;border:1px solid #ccc;" href="#">\n	',(o=n.text)?o=o.call(t,{hash:{},data:i}):(o=t.text,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n</span>\n\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-text",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("context-slider-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.currentPosition=0,this.numberOfPhotosEitherSideInViewPort=3,this.numberOfPositionsToMove=3,this.numberOfPositionsToBuffer=3,this.positionsLoadedNext=0,this.positionsLoadedPrev=0,this.positionsAheadLimit=25,this.numberOfPositionsToPreFetch=6,this.photoWidth=50,this.photoMargin=15,this.photoWidthPlusMargin=65,this.photoWidthSmall=20,this.photoMarginSmall=5,this.photoWidthPlusMarginSmall=25,this.atStart=!1,this.atEnd=!1,this.isAd=!!t.ad,this.photosInSlider={},!YUI.Env.isServer&&e.StorageHelper.getItem("slideshowInProgress")==="true"?this.slideshowInProgress=!0:this.slideshowInProgress=!1,this.slideshowDwellSeconds=5,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=t.contextData,r=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId),context:t.appContext.getModel(n.modelName,n.params)});return r.then(function(e){t.set("photo",e.photo),t.set("contextModel",e.context)},function(e){if(!e.getModelFailure&&e.code!==1||n.modelName==="photostream-models")throw e;return t.contextData.modelName="photostream-models",t.appContext.getModel("photo-models",t.photoId).then(function(e){return t.set("photo",e),t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.appContext.getModel("photostream-models",t.contextData.params).then(function(e){t.set("contextModel",e)})})}).then(function(){var r=e.merge(n.params,{photoId:t.photoId,numNext:t.numberOfPositionsToPreFetch,numPrev:t.numberOfPositionsToPreFetch,viewAs:t.contextData.viewAs,refetchAt:t.numberOfPositionsToPreFetch*2});return t.get("contextModel").getValue("photoContextList").getContext(r)}).then(function(e){t.positionsLoadedNext=t.positionsLoadedNext+e.next.length,t.positionsLoadedPrev=t.positionsLoadedPrev+e.previous.length,t.photosInSlider[0]=t.get("photo").getValue("id"),t.set("initialContextResponse",e)},function(e){if(e.notInContext)return t.get("contextModel").setValue("photoContextList",[]),t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.loadState();throw e}).then(null,function(e){throw t.appContext.warn("There was a problem loading the context slider data.",e&&e.message?e.message:e,e&&e.stack?e.stack:""),e})},assignContextPositionsAndAddToDOM:function(e){var t=this.get("container"),n=t.one(".small-slider .slider"),r=t.one(".big-slider .slider"),i=e.contextResponse,s,o,u;for(u=0;u<i.previous.length;u++)o=-1-u,typeof this.photosInSlider[o]=="undefined"&&(s=i.previous[u].toJSON(),this.photosInSlider[o]=i.previous[u].getValue("id"),s.left=o*this.photoWidthPlusMarginSmall,s.background=this.getBackgroundImage(i.previous[u]),s.url=this.getContextifiedURLForPhoto(i.previous[u]),n.append(this.templates("context-slider-photo")(s)),s.left=o*this.photoWidthPlusMargin,r.append(this.templates("context-slider-photo")(s)));for(u=0;u<i.next.length;u++)o=1+u,typeof this.photosInSlider[o]=="undefined"&&(s=i.next[u].toJSON(),this.photosInSlider[o]=i.next[u].getValue("id"),s.left=o*this.photoWidthPlusMarginSmall,s.background=this.getBackgroundImage(i.next[u]),s.url=this.getContextifiedURLForPhoto(i.next[u]),n.append(this.templates("context-slider-photo")(s)),s.left=o*this.photoWidthPlusMargin,r.append(this.templates("context-slider-photo")(s)))},checkBoundary:function(e){var t=e.contextResponse,n=e.requestedPreviousAmount,r=e.requestedNextAmount,i=e.positionWhenChecking,s=this.get("contextModel").getValue("photoContextList"),o=this.get("container"),u=o.one(".nav-l"),a=o.one(".nav-r");this.currentPosition-this.numberOfPhotosEitherSideInViewPort>this.positionsLoadedNext&&this.move(-Math.abs(this.currentPosition-this.positionsLoadedNext)),this.currentPosition<0&&Math.abs(this.currentPosition+this.numberOfPhotosEitherSideInViewPort)>this.positionsLoadedPrev&&this.move(Math.abs(this.currentPosition+this.numberOfPhotosEitherSideInViewPort)-this.positionsLoadedPrev),s.hasMinBoundary()&&t.previous.length-Math.abs(i)<=this.numberOfPhotosEitherSideInViewPort&&n>0&&(u.hide(),this.atStart=!0),s.hasMaxBoundary()&&t.next.length-Math.abs(i)<=this.numberOfPhotosEitherSideInViewPort&&r>0&&(a.hide(),this.atEnd=!0)},buildContainer:function(){var e=this.numberOfPhotosEitherSideInViewPort,t=this.get("photo").toJSON(),n=this.get("initialContextResponse"),r;t.background=this.getBackgroundImage(this.get("photo")),t.left=0,t.currentPhoto=!0,t.url=this.getContextifiedURLForPhoto(this.get("photo")),r=this.templates("context-slider-scrappy")({previousPhotos:[],nextPhotos:[],currentPhoto:[t],slideshowEnabled:this.appContext.flipper.isFlipped("enable-slideshow"),"is-ad":this.isAd}),this.isAd&&(n.next.pop(),n.next=[this.get("photo")].concat(n.next)),this.setContainerHTML(r),this.assignContextPositionsAndAddToDOM({contextResponse:this.get("initialContextResponse"),requestedPreviousAmount:e,requestedNextAmount:e}),this.checkBoundary({contextResponse:this.get("initialContextResponse"),requestedPreviousAmount:e,requestedNextAmount:e,positionWhenChecking:this.currentPosition})},buildErrorContainer:function(){this.setContainerHTML(this.templates("context-slider-scrappy")({loadingError:!0}))},activate:function(){var t=this,n=t.get("container"),r=!1,i,s,o=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return e.StorageHelper.getItem("showBigContextSlider")==="true"?(n.addClass("hover"),setTimeout(function(){n.setStyle("transition","opacity 300ms ease-out, background-position 150ms ease-out"),n.all(".context-slider").setStyle("transition","opacity 300ms ease-out")},300)):(n.setStyle("transition","opacity 300ms ease-out, background-position 150ms ease-out"),n.all(".context-slider").setStyle("transition","opacity 300ms ease-out")),this.appContext.flipper.isFlipped("enable-slideshow")&&(this.slideshowInProgress&&
this.startSlideshow(),this.registerEventHandler(this.get("container").all(".currentImage").on("click",function(e){e.preventDefault(),t.slideshowInProgress?t.stopSlideshow():t.startSlideshow()}))),e.use("transition",function(e){t.registerEventHandler(t.get("container").one(".nav-l").on("click",function(){n.setStyle("transition","opacity 300ms ease-out"),e.rapidTracker.beacon(t.name,"contextSliderMoveLeftClick"),t.move(-1*t.numberOfPositionsToMove)})),t.registerEventHandler(t.get("container").one(".nav-r").on("click",function(){n.setStyle("transition","opacity 300ms ease-out"),e.rapidTracker.beacon(t.name,"contextSliderMoveRightClick"),t.move(1*t.numberOfPositionsToMove)})),o&&(t.attachKeyEvent("down:188",e.betterThrottle(function(r){e.rapidTracker.beacon(t.name,"contextSliderMoveLeftKeyPress"),n.addClass("hover"),t.bringIntoFocus(),t.atStart||t.move(-1*t.numberOfPositionsToMove)},20)),t.attachKeyEvent("down:190",e.betterThrottle(function(r){e.rapidTracker.beacon(t.name,"contextSliderMoveRightKeyPress"),n.addClass("hover"),t.bringIntoFocus(),t.atEnd||t.move(1*t.numberOfPositionsToMove)},20))),t.registerEventHandler(n.on("hover",function(){r=!0,clearTimeout(i),i=setTimeout(function(){r&&n.addClass("hover")},150)},function(){r=!1,clearTimeout(s),e.StorageHelper.setItem("showBigContextSlider","false"),s=setTimeout(function(){r||(n.setStyles({width:"100%",height:"80px"}),n.removeClass("hover"),setTimeout(function(){n.removeAttribute("style")},300))},500)})),t.registerEventHandler(n.all(".context-thumb:not(.currentImage)").on("click",function(){e.StorageHelper.setItem("showBigContextSlider","true")}))}),this},startSlideshow:function(){function s(){if(r===0&&t.slideshowInProgress){t.appContext.flapp.navigate(n);return}i.all(".currentImage .countdown-slideshow").set("text",r),r-=1}this.slideshowInProgress=!0;var t=this,n=this.getContextifiedURLForPhoto(this.get("initialContextResponse").next[0]),r=this.slideshowDwellSeconds,i=this.get("container");e.StorageHelper.setItem("slideshowInProgress","true"),i.all(".currentImage .play-slideshow").hide(),s(),this.slideshowTimer=setInterval(function(){s()},1e3)},stopSlideshow:function(){this.slideshowInProgress=!1,this.get("container").all(".currentImage .countdown-slideshow").set("text",""),this.get("container").all(".currentImage .play-slideshow").show(),clearInterval(this.slideshowTimer),e.StorageHelper.setItem("slideshowInProgress","false")},move:function(t){var n=this,r=this.get("contextModel").getValue("photoContextList"),i=t>0?"right":"left",s=this.get("container"),o=s.one(".big-slider .slider"),u=s.one(".small-slider .slider"),a,f,l,c,h,p=s.one(".nav-l"),d=s.one(".nav-r"),v;if(i==="right"&&this.currentPosition-this.positionsLoadedNext>this.positionsAheadLimit)return!1;if(i==="left"&&this.currentPosition<=0&&Math.abs(this.currentPosition)-this.positionsLoadedPrev>this.positionsAheadLimit)return!1;s.addClass("hover"),this.currentPosition+=t,v=this.currentPosition,typeof this.photosInSlider[this.currentPosition+this.numberOfPhotosEitherSideInViewPort+1]!="undefined"&&(d.show(),this.atEnd=!1),typeof this.photosInSlider[this.currentPosition-(this.numberOfPhotosEitherSideInViewPort+1)]!="undefined"&&(p.show(),this.atStart=!1),a=this.currentPosition*this.photoWidthPlusMargin*-1,f=this.currentPosition*this.photoWidthPlusMarginSmall*-1,o.transition({left:a+"px",duration:.3,easing:"ease-out"}),u.setStyle("left",f+"px"),i==="right"?c=this.currentPosition+this.numberOfPositionsToMove+this.numberOfPositionsToBuffer:i==="left"&&(c=this.currentPosition-(this.numberOfPositionsToMove+this.numberOfPositionsToBuffer)),l=typeof this.photosInSlider[c]=="undefined",l&&(h=e.merge(n.contextData.params,{photoId:this.get("photo").getValue("id"),viewAs:n.contextData.viewAs}),i==="right"?h.numNext=Math.abs(c)+this.numberOfPositionsToPreFetch:i==="left"&&(h.numPrev=Math.abs(c)+this.numberOfPositionsToPreFetch),r.getContext(h).then(function(e){n.positionsLoadedNext=typeof h.numNext!="undefined"?h.numNext:n.positionsLoadedNext,n.positionsLoadedPrev=typeof h.numPrev!="undefined"?h.numPrev:n.positionsLoadedPrev,n.assignContextPositionsAndAddToDOM({contextResponse:e,requestedPreviousAmount:h.numPrev,requestedNextAmount:h.numNext}),n.checkBoundary({contextResponse:e,requestedPreviousAmount:h.numPrev,requestedNextAmount:h.numNext,positionWhenChecking:v})},function(e){n.checkBoundary({contextResponse:{previous:[],next:[]},requestedPreviousAmount:h.numPrev,requestedNextAmount:h.numNext,positionWhenChecking:v})}))},getBackgroundImage:function(e){var t,n=this.appContext.getViewer().getPixelRatio(),r;return t={width:this.photoWidth*n,height:this.photoWidth*n},r={cropToFit:!0,includeSizes:["sq","t","q","s","n"]},e.getSizeToFit(t,r).url},getContextifiedURLForPhoto:function(t){if(t){var n=e.URLHelper.getPhotoPage({photoId:t.getValue("id"),pathAlias:t.getValue("owner").getValue("pathAlias"),contextSuffix:this.contextData.viewAs==="public"?"public":this.get("contextModel").getValue("urlSuffix")});return n}},beforeDestroy:function(){clearInterval(this.slideshowTimer)}})},"@VERSION@",{requires:["flickr-view","hermes-template-context-slider-scrappy","hermes-template-context-slider-photo","hermes-template-context-image","hermes-template-context-text","context-slider-scrappy-css","storage-helper"],optional:[],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-engagement",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+="\n	",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-well-scrappy-edit-view"],s):f.call(e,"outlet",e["photo-well-scrappy-edit-view"],s)))+"\n",r}function d(e,t){var r="",i,s;return r+="\n	",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["fave-view"],s):f.call(e,"outlet",e["fave-view"],s)))+"\n",r}function v(e,t){var r="",i,s;return r+='\n		<a href="/video_download.gne?id=',(i=n.photoId)?i=i.call(e,{hash:{},data:t}):(i=e.photoId,i=typeof i===c?i.apply(e):i),r+=l(i)+'" class="server-only-link" title="',s={hash:{intlName:"photo-page-scrappy.DOWNLOAD_THIS_VIDEO"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'">\n	',r}function m(e,t){var r="",i,s;return r+='\n		<a href="#" title="',s={hash:{intlName:"photo-page-scrappy.DOWNLOAD_THIS_PHOTO"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+'">\n	',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;o=n["if"].call(t,t.viewerIsOwner,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(o||o===0)s+=o;s+='\n\n<div class=\'share\'>\n	<a href="#" title="',a={hash:{intlName:"photo-page-scrappy.SHARE_THIS_PHOTO"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'">\n		<i class="ui-icon-share-24"></i>\n	</a>\n</div>\n\n<div class=\'download\'>\n	',u=n["if"].call(t,t.isVideo,{hash:{},inverse:h.program(7,m,i),fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;return s+='\n			<i class="ui-icon-download"></i>\n		</a>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-engagement",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-download-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n			"'+l((r=(r=e.photo,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+'"\n		',n}function d(e,t){var n="",r;return n+='\n            <i class="ui-icon-tiny-'+l((r=(r=e.photo,r==null||r===!1?r:r.license),typeof r===f?r.apply(e):r))+'cc"></i>\n        ',n}function v(e,t){return'\n            <i class="ui-icon-tiny-government"></i>\n        '}function m(e,t){return'\n            <i class="ui-icon-tiny-noKnown"></i>\n        '}function g(e,t){return'\n			<i class="ui-icon-tiny-copyright">&nbsp;</i>\n		'}function y(e,t){var r="",i,s;return r+='\n		    <span class="license license-'+l((i=(i=e.photo,i==null||i===!1?i:i.license),typeof i===f?i.apply(e):i))+'">',s={hash:{intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):c.call(e,"intlMessage",s)))+"</span>\n		",r}function b(e,t){var r="",i,s;return r+='\n		    <span class="license license-'+l((i=(i=e.photo,i==null||i===!1?i:i.license),typeof i===f?i.apply(e):i))+'">',s={hash:{},data:t},r+=l((i=n.licenseString||e.licenseString,i?i.call(e,(i=e.photo,i==null||i===!1?i:i.license),s):c.call(e,"licenseString",(i=e.photo,i==null||i===!1?i:i.license),s)))+"</span>\n		",r}function w(e,t){var r="",i;r+='\n			<li class="',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===f?i.apply(e):i),r+=l(i),i=n["if"].call(e,e.selected,{hash:{},inverse:h.noop,fn:h.program(16,E,t),data:t});if(i||i===0)r+=i;return r+='">\n				<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-track="downloadSizeSelected',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n					<span class="label">',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===f?i.apply(e):i),r+=l(i)+'</span>\n					<span class="resolution">',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===f?i.apply(e):i),r+=l(i)+" &times; ",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===f?i.apply(e):i),r+=l(i)+"</span>\n				</a>\n			</li>\n		",r}function E(e,t){return" selected"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="download-dialog">\n	<h2>',a={hash:{intlName:"photo-page-scrappy.DOWNLOAD_PHOTO"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</h2>\n	<p class="title">\n		',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.title),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n		by "+l((o=(o=(o=t.photo,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.displayname),typeof o===f?o.apply(t):o))+'\n	</p>\n	<p class="license-info">\n	<a href="',a={hash:{},data:i},s+=l((o=n.configVal||t.configVal,o?o.call(t,"licenseUrls",(o=t.photo,o==null||o===!1?o:o.license),a):c.call(t,"configVal","licenseUrls",(o=t.photo,o==null||o===!1?o:o.license),a)))+'" class="license-url" target="_newtab">\n        ',u=n["if"].call(t,t.licenseIsCreativeCommons,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n["if"].call(t,t.licenseisGovt,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n["if"].call(t,t.licenseisNoLic,{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n["if"].call(t,t.licenseisCopy,{hash:{},inverse:h.noop,fn:h.program(9,g,i),data:i});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,t.licenseIsCreativeCommons,{hash:{},inverse:h.program(13,b,i),fn:h.program(11,y,i),data:i});if(u||u===0)s+=u;s+='\n	</a>\n    </p>\n	<ul class="sizes">\n		',u=n.each.call(t,t.sizes,{hash:{},inverse:h.noop,fn:h.program(15,w,i),data:i});if(u||u===0)s+=u;return s+="\n	</ul>\n	<p class='buttons'>\n		<a href=\""+l((o=(o=t.photo,o==null||o===!1?o:o.url),typeof o===f?o.apply(t):o))+'/sizes/l" class="all-sizes" data-track="viewAllSizesClick">',a={hash:{intlName:"photo-page-scrappy.VIEW_ALL_SIZES"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</a>\n		<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-done" data-track="downloadClick"><span>',a={hash:{intlName:"photo-page-scrappy.DOWNLOAD"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):c.call(t,"intlMessage",a)))+'</span></button>\n	</p>\n	<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-close hide-text"><span>&nbsp;</span></button>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/download-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-scrappy-download-menu",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i;r+="\n        ",i=n.each.call(e,e.sizes,{hash:{},inverse:l.noop,fn:l.program(2,p,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function p(e,t){var r="",i;return r+='\n		    <li class="',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===a?i.apply(e):i),r+=f(i)+'">\n			    <a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===a?i.apply(e):i),r+=f(i)+'" data-track="downloadSizeSelected',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===a?i.apply(e):i),r+=f(i)+'" class="download-image-size">\n				    <span class="label">',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===a?i.apply(e):i),r+=f(i)+'</span>\n				    <span class="resolution">(',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===a?i.apply(e):i),r+=f(i)+" &times; ",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===a?i.apply(e):i),r+=f(i)+")</span>\n			    </a>\n		    </li>\n	    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<ul class="sizes">\n    ',o=n["if"].call(t,t.showDownloadSizes,{hash:{},inverse:l.noop,fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;return s+='\n	<li><a href="'+f((o=(o=t.photo,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'/sizes/l" class="all-sizes server-only-link" data-track="viewAllSizesClick">',u={hash:{intlName:"photo-page-scrappy.VIEW_ALL_SIZES"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):c.call(t,"intlMessage",u)))+"</a></li>\n</ul>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/scrappy-download-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e;return e=this.templates("photo-engagement")({viewerIsOwner:this.get("photo").getValue("owner").getValue("isMe"),"photo-well-scrappy-edit-view":this.subviews["photo-well-scrappy-edit-view"].get("container"),"fave-view":this.subviews["fave-view"].get("container"),isVideo:this.get("photo").getValue("isVideo"),photoId:this.get("photo").getValue("id")}),this.setContainerHTML(e),this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var e={},t=this.get("container");return this.downloadMenuSetup(),t.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this),e.download=t.one(".download a"),e.download&&(this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),e.download.on("click",this.handleDownloadMenuButtonClick,this)),e.share=t.one(".share a"),e.share&&this.registerEventHandler(e.share.on("click",this.handleShareClicked,this)),this},handleShareClicked:function(t){t.preventDefault();var n=this,r=this.subviews["share-view"];e.rapidTracker.beacon(this.name,"shareActionBarButtonClick");if(r)return r.fire("subviewViewEvent","openShareMenu",{}),r[r.isVisible()?"hide":"show"]();this.appContext.getView("share-view",{photoId:this._params.photoId,anchorTo:n.get("container").one(".share"),arrow:!0,dropUp:!0,parent:this}).then(function(e){n.subviews["share-view"]=e,e.switchToLoading(),e.initialize().then(function(){e.show()})}).then(null,function(e){n.appContext.warn(e)})},downloadMenuSetup:function(t){var n=this.get("container"),r=e.clone(this.get("photo").toJSON()),i=this,s,o=[],u,a=this.get("photo").getValue("engagement").getValue("canDownload"),f=this.appContext.flipper.isFlipped("download-dialog-enabled"),l=!1;r.sizes.q&&(r.sizes.q.label=this.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),o.push(r.sizes.q)),r.sizes.s&&(r.sizes.s.label=this.intlMessage({intlName:"photo-page-scrappy.SMALL"}),o.push(r.sizes.s)),r.sizes.z&&(r.sizes.z.label=this.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),o.push(r.sizes.z)),r.sizes.k?(r.sizes.k.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),o.push(r.sizes.k)):r.sizes.h?(r.sizes.h.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),o.push(r.sizes.h)):r.sizes.l&&(r.sizes.l.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),o.push(r.sizes.l)),r.sizes.o&&(r.sizes.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),o.push(r.sizes.o));for(u=0;u<o.length;u++)o[u].url=o[u].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");a&&f&&(l=!0),s=this.templates("scrappy-download-menu")({photo:r,sizes:o,showDownloadSizes:l}),this.downloadMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".download"),dropUp:!0,parent:this,positioning:!1,rootEl:n}),this.downloadMenu.render(),this.downloadMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?i.fire("subviewViewEvent","make in view",n):i.fire("subviewViewEvent","close in view"))})},handleDownloadMenuButtonClick:function(t){var n=this.get("photo").getValue("isVideo");e.rapidTracker.beacon(this.name,"downloadDialogClick"),n||(t.preventDefault(),this.downloadMenu.toggle())},handleDownloadItemClick:function(t){t.preventDefault();var n;n=t.currentTarget.getAttribute("href"),document.location=n,e.rapidTracker.beacon(self.name,"photoDownloadClick"),this.downloadMenu.hide()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-download-dialog","hermes-template-scrappy-download-menu","photo-engagement-css"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["global-nav-view"],u):a.call(t,"outlet",t["global-nav-view"],u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-view"],u):a.call(t,"outlet",t["photo-well-view"],u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sidebar-view"],u):a.call(t,"outlet",t["sidebar-view"],u))),s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return"\n	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"}function f(e,t){return"\n	Please continue providing us with feedback so we can continue to improve Flickr.\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+="Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n",o=n["if"].call(t,t["opt-out-enabled"],{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="\n<br>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<form action="//',(o=n.host)?o=o.call(t,{hash:{},data:i}):(o=t.host,o=typeof o===u?o.apply(t):o),s+=a(o)+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="',(o=n["redirect-url"])?o=o.call(t,{hash:{},data:i}):(o=t["redirect-url"],o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" no-click"}function d(e,t){return" is-hidden"}function v(e,t){return" is-video"}function m(e,t){var r;return(r=n["prev-url"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-url"],r=typeof r===f?r.apply(e):r),l(r)}function g(e,t){return"#"}function y(e,t){var r;return(r=n["next-url"])?r=r.call(e,{hash:{},data:t}):(r=e["next-url"],r=typeof r===f?r.apply(e):r),l(r)}function b(e,t){var r="",i,s;r+="\n	",i=n["if"].call(e,e["opt-out-enabled"],{hash:{},inverse:c.noop,fn:c.program(14,w,t),data:t});if(i||i===0)r+=i;return r+="\n\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-toggle-view"],s):h.call(e,"outlet",e["photo-sidebar-toggle-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-title-desc-overlay-view"],s):h.call(e,"outlet",e["photo-title-desc-overlay-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-actions-view"],s):h.call(e,"outlet",e["photo-sidebar-actions-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["attribution-view"],s):h.call(e,"outlet",e["attribution-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["people-notes-view"],s):h.call(e,"outlet",e["people-notes-view"],s)))+"\n\n",r}function w(e,t){return'\n	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<a class="navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-media-view"],a):h.call(t,"outlet",t["photo-well-media-view"],a)))+'\n\n<a class="navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(11,y,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(11,y,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n',u=n.unless.call(t,t["is-ad"],{hash:{},inverse:c.noop,fn:c.program(13,b,i),data:i});if(u||u===0)s+=u;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+='\n	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>',o={hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</h2>\n			",s=n["if"].call(e,e.isSignedIn,{hash:{},inverse:l.program(4,p,t),fn:l.program(2,h,t),data:t});if(s||s===0)r+=s;return r+="\n		</div>\n	</div>\n",r}function h(e,t){var r="",i,s;return r+="\n				<p>",s={hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"<br />",s={hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</p>\n				<p><button class='ui-button'><span>",s={hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</span></button></p>\n				<p>",s={hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"</p>\n			",r}function p(e,t){var r="",i,s,o;return r+="\n				<p>",o={hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+' <a href="//',(s=n.host)?s=s.call(e,{hash:{},data:t}):(s=e.host,s=typeof s===f?s.apply(e):s),r+=a(s)+'/signin/" data-track="photoWellSignInClick">',o={hash:{intlName:"common.SIGN_IN"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</a></p>\n			",r}function d(e,t){var r="",i;r+="\n\n	",i=n["if"].call(e,e.isAd,{hash:{},inverse:l.noop,fn:l.program(7,v,t),data:t});if(i||i===0)r+=i;r+="\n		",i=n["if"].call(e,e.isVideo,{hash:{},inverse:l.program(11,g,t),fn:l.program(9,m,t),data:t});if(i||i===0)r+=i;r+="\n	",i=n["if"].call(e,e.isAd,{hash:{},inverse:l.noop,fn:l.program(14,b,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function v(e,t){var n="",r;return n+='\n		<a class="ad-wrapper" href="'+a((r=(r=e.ad,r==null||r===!1?r:r.clickUrl),typeof r===f?r.apply(e):r))+'">\n	',n}function m(e,t){var r="",i;return r+='\n			<div class="videoplayer main-photo" style="width:',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===f?i.apply(e):i),r+=a(i)+"px; height:",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===f?i.apply(e):i),r+=a(i)+'px;"></div>\n		',r}function g(e,t){var r="",i,s,o;r+='\n\n			<div class="facade-of-protection-neue ',i=n["if"].call(e,e["is-video"],{hash:{},inverse:l.noop,fn:l.program(12,y,t),data:t});if(i||i===0)r+=i;return r+='">\n				',o={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["zoom-view"],o):u.call(e,"outlet",e["zoom-view"],o)))+'\n			</div>\n\n			<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.src)?s=s.call(e,{hash:{},data:t}):(s=e.src,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="low-res-photo">\n			<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.highResSrc)?s=s.call(e,{hash:{},data:t}):(s=e.highResSrc,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)">\n			<noscript>\n				<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.highResSrc)?s=s.call(e,{hash:{},data:t}):(s=e.highResSrc,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="main-photo">\n			</noscript>\n		',r}function y(e,t){return"is-video"}function b(e,t){var r="",i,s;return r+='\n			<span class="ad-info">',s={hash:{intlName:"photo-page-scrappy.FIND_OUT_MORE_AD",brand:(i=e.ad,i==null||i===!1?i:i.brand)},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"</span>\n		</a>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;o=n["if"].call(t,t.needsInterstitial,{hash:{},inverse:l.program(6,d,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e){var t=500,n=500,r=100,i;i={photo:{render:function(){var t=this,n,i=this.get("photo"),s,o,u=new Date;return t.preloadImage&&(t.preloadImage.onload=null),s=this.getPhotoForDisplay(),o=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n=this.templates("photo-well-media")({width:s.width,height:s.height,src:o.url,highResSrc:s.url,needsInterstitial:i.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:i.getValue("isVideo"),isAd:this.isAd,"zoom-view":this.subviews["zoom-view"]?this.subviews["zoom-view"].get("container"):""}),this.setContainerHTML(n),this.fire("subviewViewEvent",s),YUI.Env.isServer?(this.serverWidth=s.width,this.serverHeight=s.height):i.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0,e.rapidTracker.beacon(this.name,"photoPageShowedSize"+(/(?:_([a-z]))?\.jpg/.exec(s.url)[1]||"\u00f8").toUpperCase());var n=t.get("container").one(".low-res-photo"),i=t.get("container").one(".main-photo"),o=new Date-u,a;o<r?(i.removeClass("is-hidden").show(),n.hide()):(i.setStyles({position:"absolute",left:0,top:0,opacity:0}),i.removeClass("is-hidden"),a=function(){i.removeAttribute("style"),n.hide()},e.UA.ie?a():e.use("transition",function(e){i.transition({duration:.25,opacity:1},a)}))},t.preloadImage.src=s.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var t,n=this,r=this.get("photo"),i=this.getPhotoForDisplay({excludeSizes:[]});return this.player?(this.player.resize(i.width,i.height),this):(t=this.templates("photo-well-media")({width:i.width,height:i.height,src:i.url,needsInterstitial:r.getValue("needsInterstitial"),isVideo:r.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.setContainerHTML(t),this.fire("subviewViewEvent",i),YUI.Env.isServer?this:(this.player=new e.FlickrVideoPlayer({container:this.get("container").one(".videoplayer"),model:r,appContext:this.appContext}),n.player.init().then(function(){n}),this.on("destroy",function(){n.player.destroy(),n.player=null}),this))}},yepVideoDisabled:{render:function(){var e,t=this.get("photo"),n=this.getPhotoForDisplay();return e=this.templates("photo-well-media-novideo")({width:n.width,height:n.height,src:n.url,needsInterstitial:t.getValue("needsInterstitial"),isVideo:t.getValue("isVideo")}),this.setContainerHTML(e),this}},ad:{render:function(){var e,t,n;return this.adJSON?t=this.adJSON:(t=this.appContext.adManager.getAdJSON(),this.adJSON=t),n=this.getAdSize(t),e=this.templates("photo-well-ad")({width:n.width,height:n.height,src:t.url,clickUrl:t.clickUrl,brand:t.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this.setContainerHTML(e),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-zoom")},disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):this.appContext.flipper.isFlipped("yep-video")?i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this):i.yepVideoDisabled.render.call(this),this},handleInterstitialDismissButtonClick:function(t){var n=this,r=this.get("personPreferences"),i=this.get("photo"),s=i.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),r.setValue("safeSearch",s),r.registry.remoteUpdate(n.appContext.auth.user.nsid).then(function(e){var t=i.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){i.registry.getValue(e,"safetyLevel")<=r.getValue("safeSearch")&&i.registry.setValue(e,"needsInterstitial",!1)}),n.buildContainer()},function(e){n.appContext.error(e.message),n.appContext.error(e.stack),n.onError(n.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:n.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:n.intlMessage({intlName:"common.OK"})},parent:n,offsetLeft:r});i.show()})},getPhotoForDisplay:function(
e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,r=this.getPixelRatio(),i;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(i=this.get("container").ancestor(),i&&(e=i.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:r})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:n,right:t,width:parseInt(this.appContext.getCookie("photoPW"),10)||t,height:parseInt(this.appContext.getCookie("photoPH"),10)||n}),e.height*=r,e.width*=r,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","hermes-template-photo-well-media-novideo","moment","flickr-video-player","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-sidebar",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+="\n	<div class='loadingError'>\n		<div class='loadingErrorInner'>\n			<p>",s={hash:{intlName:"photo-sidebar.ERROR_LOADING_SIDEBAR"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+'</p>\n			<p><button href="#" class="ui-button ui-button-cta ui-button-transparent retry">',s={hash:{intlName:"photo-sidebar.RETRY"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</button></p>\n		</div>\n	</div>\n",r}function h(e,t){var r="",i,s;return r+='\n	<div class="sidebar-panel-fixed">\n		',s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["attribution-view"],s):u.call(e,"outlet",e["attribution-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["photo-title-desc-view"],s):u.call(e,"outlet",e["photo-title-desc-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["photo-stats-view"],s):u.call(e,"outlet",e["photo-stats-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["photo-license-view"],s):u.call(e,"outlet",e["photo-license-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["context-slider-view"],s):u.call(e,"outlet",e["context-slider-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["actions-view"],s):u.call(e,"outlet",e["actions-view"],s)))+'\n	</div>\n	<div class="sidebar-panel-scrollable">\n		',s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["group-invitation-notification-view"],s):u.call(e,"outlet",e["group-invitation-notification-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["comments-view"],s):u.call(e,"outlet",e["comments-view"],s)))+"\n		",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["photo-charms-view"],s):u.call(e,"outlet",e["photo-charms-view"],s)))+"\n	</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<a class="newCloseBtn hide-text" href="',(o=n["close-url"])?o=o.call(t,{hash:{},data:i}):(o=t["close-url"],o=typeof o===f?o.apply(t):o),s+=a(o)+'" data-track="sidebarCloseButtonClick">&times;</a>\n<span class="scrollingNewCloseBtn hide-text">&times;</span>\n\n',o=n["if"].call(t,t.loadingError,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-sidebar",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-attribution",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='style="background-image: url(',(i=n.buddyicon)?i=i.call(e,{hash:{},data:t}):(i=e.buddyicon,i=typeof i===f?i.apply(e):i),r+=l(i)+');"></a>',r}function d(e,t){var r="",i;return r+='><img src="',(i=n.buddyicon)?i=i.call(e,{hash:{},data:t}):(i=e.buddyicon,i=typeof i===f?i.apply(e):i),r+=l(i)+'" width="55" height="55"></a>',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='\n<a class="attribution-icon circle-icon" data-person-nsid="',(o=n.nsid)?o=o.call(t,{hash:{},data:i}):(o=t.nsid,o=typeof o===f?o.apply(t):o),s+=l(o)+'" href="/photos/',(o=n.pathAlias)?o=o.call(t,{hash:{},data:i}):(o=t.pathAlias,o=typeof o===f?o.apply(t):o),s+=l(o)+'/" data-track="attributionAvatarClick" ',o=n["if"].call(t,t.realFullscreenEnabled,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;return s+='\n\n<div class="attribution-info">\n	\n	<a href="/photos/',(o=n.pathAlias)?o=o.call(t,{hash:{},data:i}):(o=t.pathAlias,o=typeof o===f?o.apply(t):o),s+=l(o)+'/" class="owner-name truncate" title="',a={hash:{intlName:"attribution.GO_TO_PHOTOSTREAM",name:t.displayname},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+'" data-track="attributionNameClick">',(u=n.displayname)?u=u.call(t,{hash:{},data:i}):(u=t.displayname,u=typeof u===f?u.apply(t):u),s+=l(u)+"</a>\n	\n	",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t.follow,a):h.call(t,"outlet",t.follow,a)))+"\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/attribution",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-follow",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.signedIn,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function l(e,t){var r="",i,s;r+="\n		",s=n.unless.call(e,(i=e.relationship,i==null||i===!1?i:i.isMe),{hash:{},inverse:a.noop,fn:a.program(3,c,t),data:t});if(s||s===0)r+=s;return r+="\n	",r}function c(e,t){var r="",i,s;r+="\n			",s=n.unless.call(e,(i=e.relationship,i==null||i===!1?i:i.isIgnoredBy),{hash:{},inverse:a.noop,fn:a.program(4,h,t),data:t});if(s||s===0)r+=s;return r+="\n		",r}function h(e,t){var r="",i,s;r+="\n				",s=n["if"].call(e,(i=e.relationship,i==null||i===!1?i:i.isIgnored),{hash:{},inverse:a.program(7,d,t),fn:a.program(5,p,t),data:t});if(s||s===0)r+=s;return r+="\n			",r}function p(e,t){return"\n					<button class='follow alt'>Unblock</button>\n				"}function d(e,t){var r="",i,s;r+="\n					",s=n["if"].call(e,(i=e.relationship,i==null||i===!1?i:i.isContact),{hash:{},inverse:a.program(10,m,t),fn:a.program(8,v,t),data:t});if(s||s===0)r+=s;return r+="\n				",r}function v(e,t){var r="",i,s;return r+='\n						<button class="follow is-following">',s={hash:{intlName:"common.FOLLOWING"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+'<span class="drop-icon">\u25be</span></button>\n					',r}function m(e,t){var r="",i,s;return r+='\n						<button class="follow">',s={hash:{intlName:"common.FOLLOW"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</button>\n					",r}function g(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.signedIn,{hash:{},inverse:a.noop,fn:a.program(13,y,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function y(e,t){var r="",i,s;r+="\n		",s=n.unless.call(e,(i=e.relationship,i==null||i===!1?i:i.isMe),{hash:{},inverse:a.noop,fn:a.program(14,b,t),data:t});if(s||s===0)r+=s;return r+="\n	",r}function b(e,t){var r="",i,s;r+='\n			<span class="relationship">\n				',s=n["if"].call(e,(i=e.relationship,i==null||i===!1?i:i.isIgnoredBy),{hash:{},inverse:a.program(17,E,t),fn:a.program(15,w,t),data:t});if(s||s===0)r+=s;return r+="\n			</span>\n		",r}function w(e,t){var n="";return n+="\n					\n				",n}function E(e,t){var r="",i,s;r+="\n					",s=n["if"].call(e,(i=e.relationship,i==null||i===!1?i:i.isIgnored),{hash:{},inverse:a.program(20,x,t),fn:a.program(18,S,t),data:t});if(s||s===0)r+=s;return r+="\n				",r}function S(e,t){var n="";return n+="\n						\n					",n}function x(e,t){var r="",i,s;r+="\n						",s=n["if"].call(e,(i=e.relationship,i==null||i===!1?i:i.isContact),{hash:{},inverse:a.program(23,N,t),fn:a.program(21,T,t),data:t});if(s||s===0)r+=s;return r+="\n						\n					",r}function T(e,t){var r="",i,s;return r+="\n							<button class='unfluid follow is-following ui-button ui-button-icon ui-button-transparent ui-button-dropdown'><span>",s={hash:{intlName:"common.FOLLOWING"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</span></button>\n						",r}function N(e,t){var r="",i,s;return r+="\n							<button class='unfluid follow ui-button ui-button-icon'><span>",s={hash:{intlName:"common.FOLLOW"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</span></button>\n						",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=n.helperMissing,u=this.escapeExpression,a=this;return s=n["if"].call(t,t.isFluid,{hash:{},inverse:a.program(12,g,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/follow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fluid-droparound",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return" html"}function h(e,t){return" subview-droparound"}function p(e,t){return" menu"}function d(e,t){var r="",i;return r+="max-height: ",(i=n.staticHeight)?i=i.call(e,{hash:{},data:t}):(i=e.staticHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+"px; min-height: ",(i=n.staticHeight)?i=i.call(e,{hash:{},data:t}):(i=e.staticHeight,i=typeof i===u?i.apply(e):i),r+=a(i)+"px; ",r}function v(e,t){var r="",i;return r+="width: ",(i=n.staticWidth)?i=i.call(e,{hash:{},data:t}):(i=e.staticWidth,i=typeof i===u?i.apply(e):i),r+=a(i)+"px;",r}function m(e,t){return"position: fixed;"}function g(e,t){return"hide-head"}function y(e,t){var r="",i;return r+='\n			<div class="content text-only">\n				',(i=n.textMessage)?i=i.call(e,{hash:{},data:t}):(i=e.textMessage,i=typeof i===u?i.apply(e):i),r+=a(i)+"\n			</div>\n		",r}function b(e,t){var r="",i,s;return r+='\n			<div class="content html-only">\n				',s={hash:{},data:t},r+=a((i=n.renderTrustedMarkup||e.renderTrustedMarkup,i?i.call(e,e.htmlMessage,s):f.call(e,"renderTrustedMarkup",e.htmlMessage,s)))+"\n			</div>\n		",r}function w(e,t){return'\n			<div class="content subview"></div>\n		'}function E(e,t){var r="",i;r+='\n			<div class="content menu">\n				<ul role="menu">\n					',i=n.each.call(e,e.menuItems,{hash:{},inverse:l.noop,fn:l.program(22,S,t),data:t});if(i||i===0)r+=i;return r+="\n				</ul>\n			</div>\n		",r}function S(e,t){var r="",i;r+='\n					<li role="menuitem">',i=n["if"].call(e,e.href,{hash:{},inverse:l.noop,fn:l.program(23,x,t),data:t});if(i||i===0)r+=i;(i=n.text)?i=i.call(e,{hash:{},data:t}):(i=e.text,i=typeof i===u?i.apply(e):i),r+=a(i),i=n["if"].call(e,e.href,{hash:{},inverse:l.noop,fn:l.program(25,T,t),data:t});if(i||i===0)r+=i;return r+="</li>\n					",r}function x(e,t){var r="",i;return r+='<a href="',(i=n.href)?i=i.call(e,{hash:{},data:t}):(i=e.href,i=typeof i===u?i.apply(e):i),r+=a(i)+'">',r}function T(e,t){return"</a>"}function N(e,t){return"hide-foot"}function C(e,t){return'\n		<div class="droparrow up"></div>\n	'}function k(e,t){return" invisible"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<div class="droparound',o=n["if"].call(t,t.htmlMessage,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t.subview,{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t.menuItems,{hash:{},inverse:l.noop,fn:l.program(5,p,i),data:i});if(o||o===0)s+=o;s+=" ",(o=n.classList)?o=o.call(t,{hash:{},data:i}):(o=t.classList,o=typeof o===u?o.apply(t):o),s+=a(o)+'" \nstyle="',o=n["if"].call(t,t.staticHeight,{hash:{},inverse:l.noop,fn:l.program(7,d,i),data:i});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.staticWidth,{hash:{},inverse:l.noop,fn:l.program(9,v,i),data:i});if(o||o===0)s+=o;s+="\n",o=n["if"].call(t,t.positionFixed,{hash:{},inverse:l.noop,fn:l.program(11,m,i),data:i});if(o||o===0)s+=o;s+='">\n	<div class="head ',o=n.unless.call(t,t.headContent,{hash:{},inverse:l.noop,fn:l.program(13,g,i),data:i});if(o||o===0)s+=o;s+='">\n		',(o=n.headContent)?o=o.call(t,{hash:{},data:i}):(o=t.headContent,o=typeof o===u?o.apply(t):o),s+=a(o)+'\n	</div>\n	<div class="body">\n		',o=n["if"].call(t,t.textMessage,{hash:{},inverse:l.noop,fn:l.program(15,y,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.htmlMessage,{hash:{},inverse:l.noop,fn:l.program(17,b,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.subview,{hash:{},inverse:l.noop,fn:l.program(19,w,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.menuItems,{hash:{},inverse:l.noop,fn:l.program(21,E,i),data:i});if(o||o===0)s+=o;s+='\n	</div>\n	<div class="foot ',o=n.unless.call(t,t.footContent,{hash:{},inverse:l.noop,fn:l.program(27,N,i),data:i});if(o||o===0)s+=o;s+='">\n		',(o=n.footContent)?o=o.call(t,{hash:{},data:i}):(o=t.footContent,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n	</div>\n	",o=n["if"].call(t,t.showDropArrow,{hash:{},inverse:l.noop,fn:l.program(29,C,i),data:i});if(o||o===0)s+=o;s+='\n</div>\n<div class="droparound-overlay ',o=n["if"].call(t,t.hideModalOverlay,{hash:{},inverse:l.noop,fn:l.program(31,k,i),data:i});if(o||o===0)s+=o;return s+='"></div>\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-droparound",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-flickr-balls",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="balls">\n	<div class="blue ball"></div><div class="pink ball"></div>\n</div>'}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/flickr-balls",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-droparound-view",function(e){"use strict";var t,n;t={css:{destinationContainer:"body",droparoundOverlay:".droparound-overlay",subviewContent:".content.subview",menuContent:".content.menu",droparoundContent:".body .content",droparrow:".droparrow"},options:{}},n={supportsTransform:!1,droparound:{height:0,width:0}},e.namespace("Views").FluidDroparound=e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){this.set("isActiveViewAgnostic",!0)},buildContainer:function(){return!this.get("textMessage")&&!this.get("htmlMessage")&&!this.get("subview")&&!this.get("menuItems")?(this.appContext.warn("FluidDroparoundView requires a `textMessage`, `htmlMessage`, `subview`, or `menuItems`."),this):(this.alreadyShowingDroparound()||(this.setContainerHTML(this.templates("fluid-droparound")({textMessage:this.get("textMessage"),htmlMessage:this.get("message")?this.get("message"):this.get("htmlMessage"),subview:!!this.get("subview"),menuItems:this.get("menuItems"),showDropArrow:this.get("showDropArrow"),hideModalOverlay:this.get("hideModalOverlay"),hideDroparoundOverlay:this.get("hideDroparoundOverlay"),classList:this.get("classList"),footContent:this.get("footContent"),headContent:this.get("headContent"),staticWidth:this.get("width"),staticHeight:this.get("height"),positionFixed:this.get("positionFixed")})),n.droparound.width=this.get("width"),n.droparound.height=this.get("height"),this.appendAndPosition()),this)},activate:function(){var n=this.get("container");return this.get("dismissOnOverlayClick")&&this.registerEventHandler(n.one(t.css.droparoundOverlay).on("click",e.bind(this.handleOverlayClick,this))),this.registerEventHandler(e.on("droparound:reposition",e.bind(this.anchorPositionChange,this))),this.registerEventHandler(e.on("history:change",e.bind(this.close,this))),this.get("subview")&&this.loadSubview(),this.get("menuItems")&&this.registerEventHandler(n.one(t.css.menuContent).delegate("click",this.onMenuItemClick.bind(this),"li")),this.get("observePageResize")&&this.observePageResize(),this.fire("activated"),this},loadSubview:function(){var n,r,i=!1,s=this.get("subview"),o=this;n=this.get("container").one(t.css.subviewContent),n.appendChild(e.Node.create(this.templates("flickr-balls")({})).addClass("flickr-balls")),r=setTimeout(function(){i=!0},40),this.loading=!0,s.appContext=o.appContext,s.set("isActiveViewAgnostic",!0),s.initialize().then(function(e){clearTimeout(r),i&&(e.get("container").addClass("load-transition"),setTimeout(function(){e.get("container").removeClass("load-transition")},1)),o.onSubviewInitialized(e)})},onSubviewInitialized:function(n){var r=this,i=this.get("container").one(t.css.subviewContent);if(!this.loading)return;this.loading=!1,i.one(".flickr-balls").remove(!0),i.appendChild(n.get("container")),n.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&r.fire.apply(r,e.details)}),n.normalizedActivate(),n.recursivelyActivateSubviews(),r.appendAndPosition(),r.registerEventHandler(r.get("subview").on("actionClick",e.bind(r.handleAction,r)))},onMenuItemClick:function(e){var n,r;n=e.target.ancestor("li",!0),n&&(r=this.get("container").one(t.css.menuContent).all("li").indexOf(n),r!==-1&&this.fire("selected",{menuItemIndex:r,menuItem:this.get("menuItems")[r]}))},appendAndPosition:function(){var n=e.one(t.css.destinationContainer);n&&(n.append(this.get("container")),this.repositionToElement(this.get("anchorElement")))},alreadyShowingDroparound:function(){var t=e.one("."+this.name+" .droparound");return t!==null},anchorPositionChange:function(){this.repositionToElement(this.get("anchorElement"))},observePageResize:function(){this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(t){e.fire("droparound:reposition")}))},repositionToElement:function(r){var i=this.get("container"),s=e.one("body"),o=i.one(".droparound"),u=o.one(t.css.droparrow),a=r.getXY(),f=this.get("mirrorArrowAdjustment"),l=s.get("offsetWidth"),c=this.get("showDropArrow"),h=this.get("anchorOffsetVertical"),p=this.get("anchorOffsetHorizontal"),d=this.get("anchorPositionOffset"),v=this.get("minVerticalSpace"),m=o.get("offsetHeight"),g=o.get("offsetWidth"),y=parseInt(r.getComputedStyle("width"),10)||r.get("offsetWidth"),b=parseInt(r.getComputedStyle("height"),10)||r.get("offsetHeight"),w=this.get("dropdownArrowWidth"),E=n.droparound.width?parseInt(n.droparound.width,10):parseInt(o.getComputedStyle("width"),10),S=n.droparound.height?parseInt(n.droparound.height,10):parseInt(o.getComputedStyle("height"),10),x=o.one(t.css.droparoundContent),T=this.get("minHorizontalSpace")+Math.max(m,S),N=l-Math.max(g,E)-d-T,C=r.getDOMNode().getBoundingClientRect(),k=Math.ceil((y-w)/2),L,A,O,M,_,D,P,H=this.get("preferLeft"),B=this.get("preferTop");O=E||g,M=S||m,A=a[0]-p,L=a[1]-S-h,this.get("preferredSide")?this.get("preferredSide")==="left"&&(L=a[1]+Math.round(y/2)-h,A=a[0]+y,o.one(".droparrow").removeClass("down").addClass("left")):(D=L<v||C.top-S-h<v,P=A>N,!B&&D||B&&!D?(L=a[1]+b+h,c&&u.removeClass("up").addClass("down").setStyle("left",k+f+p+"px")):c&&u.removeClass("down").addClass("up").setStyle("left",k+f+p+"px"),!H&&P||H&&!P?a[0]+y+p>l?(A=a[0]-E,c&&u.addClass("right").setStyle("left","auto").setStyle("right",k+y+"px")):(A=a[0]-E+y+p,c&&u.addClass("right").setStyle("left","auto").setStyle("right",k+p+"px")):c&&u.removeClass("right").setStyle("right","auto").setStyle("left",k+f+p+"px")),o.setXY([A,L]),this.get("menuItems")||(_={width:O+"px",height:M+"px"},x.setStyles(_))},handleOverlayClick:function(e){this.fire("clickOverlay",e),this.handleClose()},handleClose:function(e){this.fire("closeDroparound",e),this.close()},handleAction:function(e){this.fire("actionClick",e),this.get("dismissOnActionClick")&&this.close(e)},show:function(){var e=!this.isActivated,t=this;return this.initialize().then(function(){e||t.activate()}),this},close:function(){var e=this.get("container");this.loading=!1,this.destroy(),this.get("subview")&&this.get("subview").destroy(),e&&e.remove(!0)},destructor
:function(){this.detachAll()}},{ATTRS:{dismissOnOverlayClick:{value:!0},dismissOnActionClick:{value:!0},hideModalOverlay:{value:!1},preferredSide:{value:null},message:{value:null},textMessage:{value:null},htmlMessage:{value:null},footContent:{value:null},headContent:{value:null},width:{value:0},height:{value:0},subview:{value:null},menuItems:{value:null},classList:{value:""},anchorElement:{value:null},showDropArrow:{value:!1},anchorOffsetVertical:{value:15},anchorOffsetHorizontal:{value:5},contentPadding:{value:12},minVerticalSpace:{value:60},minHorizontalSpace:{value:60},dropdownArrowWidth:{value:21},anchorPositionOffset:{value:15},observePageResize:{value:!0},preferLeft:{value:!1},preferTop:{value:!1},mirrorArrowAdjustment:{value:0},positionFixed:{value:!1}}})},"@VERSION@",{requires:["flickr-view","fluid-css","hermes-template-fluid-droparound","fluid-balls-css","hermes-template-flickr-balls"],optionalRequires:["fluid"]});
YUI.add("hermes-template-following-dropdown",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){return'\n			<label class = "checked">\n				<input type="checkbox" checked="checked" id="friend-checkbox" />\n		'}function p(e,t){return'\n			<label>\n				<input type="checkbox" id="friend-checkbox" />\n		'}function d(e,t){return'\n			<label class="checked">\n				<input type="checkbox" checked="checked" id="family-checkbox" />\n		'}function v(e,t){return'\n			<label>\n				<input type="checkbox" id="family-checkbox" />\n		'}function m(e,t){var r="",i,s;return r+='\n			<button class="follow unfollow">',s={hash:{intlName:"common.UNFOLLOW"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</button>\n		",r}function g(e,t){var r="",i,s;return r+='\n			<a href="#"><i class="ui-icon-tiny-unfollow"></i> ',s={hash:{intlName:"common.UNFOLLOW"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</a>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<ul>\n	<li class="following-friend">\n		',o=n["if"].call(t,t.isFriend,{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;s+="\n			",a={hash:{intlName:"common.FRIEND"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'\n		</label>\n	</li>\n	<li class="following-family">\n		',u=n["if"].call(t,t.isFamily,{hash:{},inverse:c.program(7,v,i),fn:c.program(5,d,i),data:i});if(u||u===0)s+=u;s+="\n			",a={hash:{intlName:"common.FAMILY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'\n		</label>\n	</li>\n	<li class="divider"></li>\n	<li class="following-unfollow">\n		',u=n["if"].call(t,t.isFluid,{hash:{},inverse:c.program(11,g,i),fn:c.program(9,m,i),data:i});if(u||u===0)s+=u;return s+="\n	</li>\n</ul>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/following-dropdown",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("relationship-menu-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.relationship=t,e.nsid=e.nsid||t.id})},buildContainer:function(){return this.setContainerHTML(this.templates("following-dropdown")({isFriend:this.relationship.getValue("isFriend"),isFamily:this.relationship.getValue("isFamily"),isFluid:!0})),this},activate:function(){var e=this.get("container"),t=this;return this.registerEventHandler(this.relationship.on("valuesChanged",function(){t.buildContainer()})),this.registerEventHandler(e.delegate("click",function(e){t.handleUnfollowClick(e)},".following-unfollow")),this.registerEventHandler(e.delegate("change",function(e){t.handleFriendChange(e)},".following-friend input")),this.registerEventHandler(e.delegate("change",function(e){t.handleFamilyChange(e)},".following-family input")),this},handleUnfollowClick:function(t){var n=this;t.preventDefault(),this.relationship.registry.toggleFollowing(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(null,function(e){n.relationship.setValue("isContact",!0),n.buildContainer(),n.appContext.error(e)}),e.rapidTracker.beacon(this.name,"unfollowButtonClick"),this.fire("onUnfollow")},handleFriendChange:function(e){var t=this;this.relationship.registry.toggleFriend(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(null,function(e){t.relationship.registry.toggleFriend(t.nsid),t.buildContainer(),t.onError(t.intlMessage({intlName:"photo-page-scrappy.RELATIONSHIP_FRIEND_ERROR"})),t.appContext.error(e)})},handleFamilyChange:function(e){var t=this;this.relationship.registry.toggleFamily(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(null,function(e){t.relationship.registry.toggleFamily(t.nsid),t.buildContainer(),t.onError(t.intlMessage({intlName:"photo-page-scrappy.RELATIONSHIP_FAMILY_ERROR"})),t.appContext.error(e)})}})},"@VERSION@",{requires:["promise","fluid-css","hermes-template-following-dropdown","relationship-menu-css"],langBundles:["common"]});
